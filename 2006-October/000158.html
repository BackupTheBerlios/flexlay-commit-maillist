<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Flexlay-commit] r663 - in trunk/netbrush: . src src/widget
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/flexlay-commit/2006-October/index.html" >
   <LINK REL="made" HREF="mailto:flexlay-commit%40lists.berlios.de?Subject=Re%3A%20%5BFlexlay-commit%5D%20r663%20-%20in%20trunk/netbrush%3A%20.%20src%20src/widget&In-Reply-To=%3C200610200832.k9K8WPtc009911%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000157.html">
   <LINK REL="Next"  HREF="000159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Flexlay-commit] r663 - in trunk/netbrush: . src src/widget</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:flexlay-commit%40lists.berlios.de?Subject=Re%3A%20%5BFlexlay-commit%5D%20r663%20-%20in%20trunk/netbrush%3A%20.%20src%20src/widget&In-Reply-To=%3C200610200832.k9K8WPtc009911%40sheep.berlios.de%3E"
       TITLE="[Flexlay-commit] r663 - in trunk/netbrush: . src src/widget">grumbel at mail.berlios.de
       </A><BR>
    <I>Fri Oct 20 10:32:25 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000157.html">[Flexlay-commit] r662 - trunk/netbrush
</A></li>
        <LI>Next message: <A HREF="000159.html">[Flexlay-commit] r664 - in trunk/netbrush: . src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#158">[ date ]</a>
              <a href="thread.html#158">[ thread ]</a>
              <a href="subject.html#158">[ subject ]</a>
              <a href="author.html#158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2006-10-20 10:32:24 +0200 (Fri, 20 Oct 2006)
New Revision: 663

Added:
   trunk/netbrush/src/
   trunk/netbrush/src/SConstruct
   trunk/netbrush/src/alpha_picker.cpp
   trunk/netbrush/src/alpha_picker.hpp
   trunk/netbrush/src/brush_widget.cpp
   trunk/netbrush/src/brush_widget.hpp
   trunk/netbrush/src/brushmask.cpp
   trunk/netbrush/src/brushmask.hpp
   trunk/netbrush/src/client.cpp
   trunk/netbrush/src/client_state.cpp
   trunk/netbrush/src/client_state.hpp
   trunk/netbrush/src/color.hpp
   trunk/netbrush/src/debug.cpp
   trunk/netbrush/src/debug.hpp
   trunk/netbrush/src/drawing_context.cpp
   trunk/netbrush/src/drawing_context.hpp
   trunk/netbrush/src/drawing_parameter.cpp
   trunk/netbrush/src/drawing_parameter.hpp
   trunk/netbrush/src/generic_brush.cpp
   trunk/netbrush/src/generic_brush.hpp
   trunk/netbrush/src/globals.cpp
   trunk/netbrush/src/globals.hpp
   trunk/netbrush/src/graphic_context_state.cpp
   trunk/netbrush/src/graphic_context_state.hpp
   trunk/netbrush/src/grayscale_buffer.cpp
   trunk/netbrush/src/grayscale_buffer.hpp
   trunk/netbrush/src/hue_picker.cpp
   trunk/netbrush/src/hue_picker.hpp
   trunk/netbrush/src/math/
   trunk/netbrush/src/navigation.cpp
   trunk/netbrush/src/navigation.hpp
   trunk/netbrush/src/saturation_value_picker.cpp
   trunk/netbrush/src/saturation_value_picker.hpp
   trunk/netbrush/src/screen_buffer.cpp
   trunk/netbrush/src/screen_buffer.hpp
   trunk/netbrush/src/server.cpp
   trunk/netbrush/src/server_connection.cpp
   trunk/netbrush/src/server_connection.hpp
   trunk/netbrush/src/stroke.cpp
   trunk/netbrush/src/stroke.hpp
   trunk/netbrush/src/stroke_buffer.cpp
   trunk/netbrush/src/stroke_buffer.hpp
   trunk/netbrush/src/video.cpp
   trunk/netbrush/src/video.hpp
   trunk/netbrush/src/widget/
   trunk/netbrush/src/widget/button.cpp
   trunk/netbrush/src/widget/button.hpp
   trunk/netbrush/src/widget/scrollbar.cpp
   trunk/netbrush/src/widget/scrollbar.hpp
   trunk/netbrush/src/widget/slider_widget.cpp
   trunk/netbrush/src/widget/slider_widget.hpp
   trunk/netbrush/src/widget/widget.cpp
   trunk/netbrush/src/widget/widget_manager.cpp
Removed:
   trunk/netbrush/SConstruct
   trunk/netbrush/alpha_picker.cpp
   trunk/netbrush/alpha_picker.hpp
   trunk/netbrush/brush_widget.cpp
   trunk/netbrush/brush_widget.hpp
   trunk/netbrush/brushmask.cpp
   trunk/netbrush/brushmask.hpp
   trunk/netbrush/client.cpp
   trunk/netbrush/client_state.cpp
   trunk/netbrush/client_state.hpp
   trunk/netbrush/color.hpp
   trunk/netbrush/debug.cpp
   trunk/netbrush/debug.hpp
   trunk/netbrush/drawing_context.cpp
   trunk/netbrush/drawing_context.hpp
   trunk/netbrush/drawing_parameter.cpp
   trunk/netbrush/drawing_parameter.hpp
   trunk/netbrush/generic_brush.cpp
   trunk/netbrush/generic_brush.hpp
   trunk/netbrush/globals.cpp
   trunk/netbrush/globals.hpp
   trunk/netbrush/graphic_context_state.cpp
   trunk/netbrush/graphic_context_state.hpp
   trunk/netbrush/grayscale_buffer.cpp
   trunk/netbrush/grayscale_buffer.hpp
   trunk/netbrush/hue_picker.cpp
   trunk/netbrush/hue_picker.hpp
   trunk/netbrush/math/
   trunk/netbrush/navigation.cpp
   trunk/netbrush/navigation.hpp
   trunk/netbrush/saturation_value_picker.cpp
   trunk/netbrush/saturation_value_picker.hpp
   trunk/netbrush/screen_buffer.cpp
   trunk/netbrush/screen_buffer.hpp
   trunk/netbrush/server.cpp
   trunk/netbrush/server_connection.cpp
   trunk/netbrush/server_connection.hpp
   trunk/netbrush/src/widget/button.cpp
   trunk/netbrush/src/widget/button.hpp
   trunk/netbrush/src/widget/callback.hpp
   trunk/netbrush/src/widget/slider_widget.cpp
   trunk/netbrush/src/widget/slider_widget.hpp
   trunk/netbrush/src/widget/widget.cpp
   trunk/netbrush/src/widget/widget_manager.cpp
   trunk/netbrush/stroke.cpp
   trunk/netbrush/stroke.hpp
   trunk/netbrush/stroke_buffer.cpp
   trunk/netbrush/stroke_buffer.hpp
   trunk/netbrush/video.cpp
   trunk/netbrush/video.hpp
   trunk/netbrush/widget/
Log:
- some directory reorganisation

Deleted: trunk/netbrush/SConstruct
===================================================================
--- trunk/netbrush/SConstruct	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/SConstruct	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,56 +0,0 @@
-# netbrush_env = Environment()
-# netbrush_env.ParseConfig('sdl-config --cflags --libs')
-# netbrush_env['LIBS'] += ['SDL_net']
-# netbrush_env['CXXFLAGS'] += ['-O2', '-Wall', '-g']
-# netbrush_env.Program('netbrush', ['net.cpp', 'vector.cpp'])
-
-server_env = Environment()
-server_env.ParseConfig('sdl-config --cflags --libs')
-server_env['CXXFLAGS'] += ['-O0', '-Wall', '-g']
-server_env['LIBS'] += ['SDL_net']
-server_env.Program('server', [
-        'server.cpp'
-])
-
-
-client_env = Environment()
-client_env.ParseConfig('sdl-config --cflags --libs')
-client_env['CXXFLAGS'] += ['-O0', '-Wall', '-g']
-client_env['CPPPATH'] += ['.']
-client_env['LIBS'] += ['SDL_image', 'SDL_net']
-client_env.Program('client', [
-        'alpha_picker.cpp',
-        'brush_widget.cpp',
-        'brushmask.cpp',
-        'client.cpp', 
-        'client_state.cpp',
-        'debug.cpp',
-        'drawing_context.cpp',
-        'drawing_parameter.cpp',
-        'generic_brush.cpp',
-        'globals.cpp',
-        'grayscale_buffer.cpp', 
-        'hue_picker.cpp',
-        'math/matrix.cpp',
-        'math/origin.cpp',
-        'math/quaternion.cpp',
-        'math/rect.cpp',
-        'math/vector.cpp',
-        'saturation_value_picker.cpp',
-        'screen_buffer.cpp',
-        'server_connection.cpp',
-        'stroke.cpp',
-        'stroke_buffer.cpp',
-        'video.cpp',
-        'widget/button.cpp',
-        'widget/scrollbar.cpp',
-        'widget/slider_widget.cpp',
-        'widget/widget.cpp',
-        'widget/widget_manager.cpp',
-        'navigation.cpp',
-        'graphic_context_state.cpp',
-#        'widget/events.cpp',
-])
-
-# EOF #
-

Deleted: trunk/netbrush/alpha_picker.cpp
===================================================================
--- trunk/netbrush/alpha_picker.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/alpha_picker.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,138 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;vector&gt;
-#include &quot;video.hpp&quot;
-#include &quot;color.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;widget/widget_manager.hpp&quot;
-#include &quot;alpha_picker.hpp&quot;
-
-AlphaPicker::AlphaPicker(const Rect&amp; rect_)
-  : Widget(rect_), dragging(0)
-{
-  std::vector&lt;Color&gt; colors;
-
-  colors.push_back(Color(255,   0,   0));
-  colors.push_back(Color(255,   0, 255));
-  colors.push_back(Color(  0,   0, 255));
-  colors.push_back(Color(  0, 255, 255));
-  colors.push_back(Color(  0, 255,   0));
-  colors.push_back(Color(255, 255,   0));
-  colors.push_back(Color(255,   0,   0));
-
-  surface = create_surface(rect_.get_width(), rect_.get_height());
-  set_color(Color(255,255,0));
-}
-
-void
-AlphaPicker::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  set_dirty(true);
-  if (dragging)
-    {
-      click_pos.x = motion.x;
-      click_pos.y = motion.y;
-      client_draw_param-&gt;opacity = 255 * click_pos.x/get_rect().get_width();
-    }
-}
-
-void
-AlphaPicker::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (button.button == 1)
-    {
-      if (button.state == SDL_RELEASED)
-        {
-          dragging = false;
-          widget_manager-&gt;ungrab(this);
-        }
-      else if (button.state == SDL_PRESSED)
-        {
-          dragging = true;
-
-          click_pos.x = button.x;
-          click_pos.y = button.y;
-
-          client_draw_param-&gt;opacity = 255 * click_pos.x/get_rect().get_width();
-
-          set_dirty(true);
-          widget_manager-&gt;grab(this);
-        }
-    }
-}
-
-void
-AlphaPicker::draw(SDL_Surface* target)
-{
-  SDL_Rect pos;
-  pos.x = get_rect().left;
-  pos.y = get_rect().top;
-
-  SDL_BlitSurface(surface, 0, target, &amp;pos);
-
-
-  SDL_Rect vline;
-  vline.x = click_pos.x + get_rect().left - 1;
-  vline.y = 0 + get_rect().top;
-  vline.w = 3;
-  vline.h = get_rect().get_height();
-
-  SDL_FillRect(target, &amp;vline, SDL_MapRGB(target-&gt;format, 0, 0, 0));
-
-  vline.x += 1;
-  vline.w = 1;
-
-  SDL_FillRect(target, &amp;vline, SDL_MapRGB(target-&gt;format, 255, 255, 255));
-}
-
-void
-AlphaPicker::set_color(const Color&amp; color)
-{
-  client_draw_param-&gt;color = color;
-
-  SDL_LockSurface(surface);
-  Uint8* data = static_cast&lt;Uint8*&gt;(surface-&gt;pixels);
-
-  for(int y = 0; y &lt; surface-&gt;h; ++y)
-    for(int x = 0; x &lt; surface-&gt;w; ++x)
-      {
-        Uint8 c = 255 * x / surface-&gt;w;
-
-        Uint8 check = 0;
-        if (((x / 8) % 2) ^ (y / 8) % 2)
-          check = 128;
-
-        data[3*(y * surface-&gt;w + x)+0] = (color.r*c + (255 - c)*check)/255;
-        data[3*(y * surface-&gt;w + x)+1] = (color.g*c + (255 - c)*check)/255;
-        data[3*(y * surface-&gt;w + x)+2] = (color.b*c + (255 - c)*check)/255;
-      }
-  SDL_UnlockSurface(surface);  
-  
-  set_dirty(true);  
-}
-
-/* EOF */

Deleted: trunk/netbrush/alpha_picker.hpp
===================================================================
--- trunk/netbrush/alpha_picker.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/alpha_picker.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,58 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_ALPHA_PICKER_HPP
-#define HEADER_ALPHA_PICKER_HPP
-
-#include &quot;widget/widget.hpp&quot;
-
-/** */
-class AlphaPicker : public Widget
-{
-private:
-  SDL_Surface* surface;
-  bool  dragging;
-  Point click_pos;
-
-public:
-  AlphaPicker(const Rect&amp; rect);
-
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-
-  void on_enter() {}
-  void on_leave() {}
-
-  void draw(SDL_Surface* target);
-
-  void set_color(const Color&amp; color);
-private:
-  AlphaPicker (const AlphaPicker&amp;);
-  AlphaPicker&amp; operator= (const AlphaPicker&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/brush_widget.cpp
===================================================================
--- trunk/netbrush/brush_widget.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/brush_widget.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,201 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;algorithm&gt;
-#include &quot;video.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;brushmask.hpp&quot;
-#include &quot;brush_widget.hpp&quot;
-
-BrushWidget::BrushWidget(const Rect&amp; rect_)
-  : Widget(rect_)
-{
-  surface = create_surface(rect_.get_width(), rect_.get_height());
-  
-}
-
-BrushWidget::~BrushWidget()
-{
-  SDL_FreeSurface(surface);
-}
-
-void
-BrushWidget::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  set_dirty(true);
-}
-
-void
-BrushWidget::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-}
-
-void
-BrushWidget::draw(SDL_Surface* target)
-{
-  SDL_Rect pos;
-  pos.x = get_rect().left;
-  pos.y = get_rect().top;
-
-  SDL_BlitSurface(surface, 0, target, &amp;pos);
-}
-
-void 
-BrushWidget::set_brush(const GenericBrush&amp; brush)
-{
-  GrayscaleBuffer* brushmask = generate_brushmask(brush.shape,
-                                                  brush.radius,
-                                                  brush.spikes,     // spikes
-                                                  brush.hardness,  // hardness
-                                                  brush.aspect_ratio,  // aspect
-                                                  brush.angle);
-  
-  SDL_FillRect(surface, NULL, SDL_MapRGB(surface-&gt;format, 255, 255, 255));
-  SDL_LockSurface(surface);
-  Uint8* data = static_cast&lt;Uint8*&gt;(surface-&gt;pixels);
-
-  int x_of = std::max(0, (surface-&gt;w - brushmask-&gt;get_width())/2);
-  int y_of = std::max(0, (surface-&gt;h - brushmask-&gt;get_height())/2);
-  
-  for(int y = 0; y &lt; std::min(brushmask-&gt;get_height(), surface-&gt;h); ++y)
-    for(int x = 0; x &lt; std::min(brushmask-&gt;get_width(), surface-&gt;w); ++x)
-      {
-        if (0)
-          { // Checkboard fun
-            Uint8 check = 64;
-            if (((x / 8) % 2) ^ (y / 8) % 2)
-              check = 128+64;
-
-            Uint8 c = brushmask-&gt;at(x,y);
-
-            data[3*((y+y_of) * surface-&gt;w + (x+x_of))+0] = ((255-c) * check + c*client_draw_param-&gt;color.r)/255;
-            data[3*((y+y_of) * surface-&gt;w + (x+x_of))+1] = ((255-c) * check + c*client_draw_param-&gt;color.g)/255;
-            data[3*((y+y_of) * surface-&gt;w + (x+x_of))+2] = ((255-c) * check + c*client_draw_param-&gt;color.b)/255;
-          }
-        else
-          {
-            Uint8 c = 255 - brushmask-&gt;at(x,y);
-            data[3*((y+y_of) * surface-&gt;w + (x+x_of))+0] = c;
-            data[3*((y+y_of) * surface-&gt;w + (x+x_of))+1] = c;
-            data[3*((y+y_of) * surface-&gt;w + (x+x_of))+2] = c;
-          }
-      }
-      
-  SDL_UnlockSurface(surface); 
-  set_dirty(true);
-
-  // FIXME: where is delete?!
-  client_draw_param-&gt;brush_file = &quot;&quot;;
-  client_draw_param-&gt;brush_buffer = brushmask;
-
-  update_mouse_cursor();
-}
-
-void
-BrushWidget::update_mouse_cursor()
-{
-  if (client_draw_param-&gt;generic_brush.radius &lt; 5.0f)
-    return ;
-
-  GrayscaleBuffer* brush = client_draw_param-&gt;brush_buffer;
-  
-  int w     = brush-&gt;get_width();
-  int pitch = brush-&gt;get_width()/8 + 1;
-  int h     = brush-&gt;get_height();
-  int len   = pitch * h;
-  Uint8 data[len];
-  Uint8 mask[len];
-
-  memset(data, 0, len);
-  memset(mask, 0, len);
-
-  for(int y = 1; y &lt; brush-&gt;get_height()-1; ++y)
-    for(int x = 1; x &lt; brush-&gt;get_width()-1; ++x)
-      {
-        int threshold = 64;
-
-        Uint8 check = 0;
-        if (((x / 1) % 2) ^ (y / 1) % 2)
-          check = 1;
-
-
-        if ((brush-&gt;at(x-1, y) &lt; threshold &amp;&amp; 
-             brush-&gt;at(x+1, y) &gt; threshold)
-            ||
-            (brush-&gt;at(x-1, y) &gt; threshold &amp;&amp; 
-             brush-&gt;at(x+1, y) &lt; threshold)
-            ||
-            (brush-&gt;at(x, y-1) &lt; threshold &amp;&amp; 
-             brush-&gt;at(x, y+1) &gt; threshold)
-            ||
-            (brush-&gt;at(x, y-1) &gt; threshold &amp;&amp; 
-             brush-&gt;at(x, y+1) &lt; threshold)
-            )
-          { // black
-            data[y * pitch + x/8] |= (check &lt;&lt; (7 - (x%8)));
-            mask[y * pitch + x/8] |= (0x01 &lt;&lt; (7 - (x%8)));
-          }
-      }
-  
-  if (w &gt; 7 &amp;&amp; h &gt; 7)
-    {
-      int y = h / 2;
-      int x = 0;
-      for(x = w/2 - 3; x &lt;= w/2 + 3; ++x)
-        {
-          data[y * pitch + x/8] |= (0x01 &lt;&lt; (7 - (x%8)));
-          mask[y * pitch + x/8] |= (0x01 &lt;&lt; (7 - (x%8)));
-        }
-
-      x = w / 2;
-      for(int y = h/2 - 3; y &lt;= h/2 + 3; ++y)
-        {
-          data[y * pitch + x/8] |= (0x01 &lt;&lt; (7 - (x%8)));
-          mask[y * pitch + x/8] |= (0x01 &lt;&lt; (7 - (x%8)));
-        }
-
-
-      y = h / 2;
-      for(x = w/2 - 1; x &lt;= w/2 + 1; ++x)
-        {
-          data[y * pitch + x/8] ^= (0x01 &lt;&lt; (7 - (x%8)));
-          mask[y * pitch + x/8] |= (0x01 &lt;&lt; (7 - (x%8)));
-        }
-      
-      x = w / 2;
-      for(int y = h/2 - 1; y &lt;= h/2 + 1; ++y)
-        {
-          data[y * pitch + x/8] ^= (0x01 &lt;&lt; (7 - (x%8)));
-          mask[y * pitch + x/8] |= (0x01 &lt;&lt; (7 - (x%8)));
-        }
-    }
-
-  SDL_Cursor* cursor = SDL_CreateCursor(data, mask, pitch*8, h, 
-                                        w/2, h/2);
-  SDL_SetCursor(cursor);
-}
-
-/* EOF */

Deleted: trunk/netbrush/brush_widget.hpp
===================================================================
--- trunk/netbrush/brush_widget.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/brush_widget.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,60 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_BRUSH_WIDGET_HPP
-#define HEADER_BRUSH_WIDGET_HPP
-
-#include &quot;generic_brush.hpp&quot;
-#include &quot;widget/widget.hpp&quot;
-
-/** */
-class BrushWidget : public Widget
-{
-private:
-  SDL_Surface* surface;
-
-public:
-  BrushWidget(const Rect&amp; rect);
-  ~BrushWidget();
-
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-
-  void on_enter() {}
-  void on_leave() {}
-
-  void draw(SDL_Surface* target);
-  void set_brush(const GenericBrush&amp; brush);
-
-  void update_mouse_cursor();
-
-private:
-  BrushWidget (const BrushWidget&amp;);
-  BrushWidget&amp; operator= (const BrushWidget&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/brushmask.cpp
===================================================================
--- trunk/netbrush/brushmask.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/brushmask.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,293 +0,0 @@
-//  $Id$
-// 
-//  Flexlay - A Generic 2D Game Editor
-//  Copyright (C) 2004 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-/* Most of the code below is taken from Gimp2.2:
-   gimp_brush_generated module Copyright 1998 Jay Cox &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">jaycox at earthlink.net</A>&gt; 
- */
-
-#include &lt;iostream&gt;
-#include &lt;math.h&gt;
-#include &lt;string.h&gt;
-#include &quot;brushmask.hpp&quot;
-
-#define OVERSAMPLING 5
-
-typedef int gint;
-typedef unsigned char guchar;
-
-#define gimp_deg_to_rad(angle) ((angle) * (2.0 * M_PI) / 360.0)
-#define gimp_rad_to_deg(angle) ((angle) * 360.0 / (2.0 * M_PI))
-
-static double
-gauss (double f)
-{
-  /* this aint' a real gauss function */
-  if (f &lt; -0.5)
-    {
-      f = -1.0 - f;
-      return (2.0 * f*f);
-    }
-
-  if (f &lt; 0.5)
-    return (1.0 - 2.0 * f*f);
-
-  f = 1.0 - f;
-  return (2.0 * f*f);
-}
-
-struct GimpVector2
-{
-  double x, y;
-};
-
-struct GimpBrushGenerated
-{
-  GrayscaleBuffer *mask;     /*  the actual mask                */
-
-  GimpVector2   x_axis;     /*  for calculating brush spacing  */
-  GimpVector2   y_axis;     /*  for calculating brush spacing  */
-
-  BrushShape shape;
-  float                  radius;
-  gint                    spikes;       /* 2 - 20     */
-  float                  hardness;     /* 0.0 - 1.0  */
-  float                  aspect_ratio; /* y/x        */
-  float                  angle;        /* in degrees */
-};
-
-
-static void
-gimp_brush_generated_dirty (GimpBrushGenerated *brush)
-{
-  gint                x, y;
-  guchar             *centerp;
-  double             d;
-  double             exponent;
-  guchar              a;
-  gint                length;
-  gint                width  = 0;
-  gint                height = 0;
-  guchar             *lookup;
-  double             sum;
-  double             c, s, cs, ss;
-  double             short_radius;
-  double             buffer[OVERSAMPLING];
-
-  s = sin (gimp_deg_to_rad (brush-&gt;angle));
-  c = cos (gimp_deg_to_rad (brush-&gt;angle));
-
-  short_radius = brush-&gt;radius / brush-&gt;aspect_ratio;
-
-  brush-&gt;x_axis.x =        c * brush-&gt;radius;
-  brush-&gt;x_axis.y = -1.0 * s * brush-&gt;radius;
-  brush-&gt;y_axis.x =        s * short_radius;
-  brush-&gt;y_axis.y =        c * short_radius;
-
-  switch (brush-&gt;shape)
-    {
-    case BRUSH_SHAPE_CIRCLE:
-      width  = static_cast&lt;int&gt;(ceil (sqrt (brush-&gt;x_axis.x * brush-&gt;x_axis.x +
-                                            brush-&gt;y_axis.x * brush-&gt;y_axis.x)));
-      height = static_cast&lt;int&gt;(ceil (sqrt (brush-&gt;x_axis.y * brush-&gt;x_axis.y +
-                                            brush-&gt;y_axis.y * brush-&gt;y_axis.y)));
-      break;
-
-    case BRUSH_SHAPE_SQUARE:
-      width  = static_cast&lt;int&gt;(ceil (fabs (brush-&gt;x_axis.x) + fabs (brush-&gt;y_axis.x)));
-      height = static_cast&lt;int&gt;(ceil (fabs (brush-&gt;x_axis.y) + fabs (brush-&gt;y_axis.y)));
-      break;
-
-    case BRUSH_SHAPE_DIAMOND:
-      width  = static_cast&lt;int&gt;(ceil (std::max(fabs (brush-&gt;x_axis.x), fabs (brush-&gt;y_axis.x))));
-      height = static_cast&lt;int&gt;(ceil (std::max(fabs (brush-&gt;x_axis.y), fabs (brush-&gt;y_axis.y))));
-      break;
-
-    default:
-      return;
-    }
-
-  if (brush-&gt;spikes &gt; 2)
-    {
-      /* could be optimized by respecting the angle */
-      width = height = static_cast&lt;int&gt;(ceil (sqrt (brush-&gt;radius * brush-&gt;radius +
-                                                    short_radius * short_radius)));
-      brush-&gt;y_axis.x =        s * brush-&gt;radius;
-      brush-&gt;y_axis.y =        c * brush-&gt;radius;
-    }
-
-  brush-&gt;mask = new GrayscaleBuffer(width  * 2 + 1,
-                                    height * 2 + 1,
-                                    0);
-
-  centerp = brush-&gt;mask-&gt;get_data() + height * brush-&gt;mask-&gt;get_width() + width;
-
-  /* set up lookup table */
-  length = static_cast&lt;int&gt;(OVERSAMPLING * ceil (1 + sqrt (2 *
-                                                           ceil (brush-&gt;radius + 1.0) *
-                                                           ceil (brush-&gt;radius + 1.0))));
-
-  if ((1.0 - brush-&gt;hardness) &lt; 0.0000004)
-    exponent = 1000000.0;
-  else
-    exponent = 0.4 / (1.0 - brush-&gt;hardness);
-
-  lookup = new guchar[length];
-  sum = 0.0;
-
-  for (x = 0; x &lt; OVERSAMPLING; x++)
-    {
-      d = fabs ((x + 0.5) / OVERSAMPLING - 0.5);
-
-      if (d &gt; brush-&gt;radius)
-        buffer[x] = 0.0;
-      else
-        buffer[x] = gauss (pow (d / brush-&gt;radius, exponent));
-
-      sum += buffer[x];
-    }
-
-  for (x = 0; d &lt; brush-&gt;radius || sum &gt; 0.00001; d += 1.0 / OVERSAMPLING)
-    {
-      sum -= buffer[x % OVERSAMPLING];
-
-      if (d &gt; brush-&gt;radius)
-        buffer[x % OVERSAMPLING] = 0.0;
-      else
-        buffer[x % OVERSAMPLING] = gauss (pow (d / brush-&gt;radius, exponent));
-
-      sum += buffer[x % OVERSAMPLING];
-      lookup[x++] = static_cast&lt;int&gt;(rint(sum * (255.0 / OVERSAMPLING)));
-    }
-
-  while (x &lt; length)
-    {
-      lookup[x++] = 0;
-    }
-
-  cs = cos (- 2 * M_PI / brush-&gt;spikes);
-  ss = sin (- 2 * M_PI / brush-&gt;spikes);
-
-  /* for an even number of spikes compute one half and mirror it */
-  for (y = (brush-&gt;spikes % 2 ? -height : 0); y &lt;= height; y++)
-    {
-      for (x = -width; x &lt;= width; x++)
-        {
-          double tx, ty, angle;
-
-          tx = c*x - s*y;
-          ty = fabs (s*x + c*y);
-
-          if (brush-&gt;spikes &gt; 2)
-            {
-              angle = atan2 (ty, tx);
-
-              while (angle &gt; M_PI / brush-&gt;spikes)
-                {
-                  double sx = tx, sy = ty;
-
-                  tx = cs * sx - ss * sy;
-                  ty = ss * sx + cs * sy;
-
-                  angle -= 2 * M_PI / brush-&gt;spikes;
-                }
-            }
-
-          ty *= brush-&gt;aspect_ratio;
-          switch (brush-&gt;shape)
-            {
-            case BRUSH_SHAPE_CIRCLE:
-              d = sqrt (tx*tx + ty*ty);
-              break;
-            case BRUSH_SHAPE_SQUARE:
-              d = std::max (fabs (tx), fabs (ty));
-              break;
-            case BRUSH_SHAPE_DIAMOND:
-              d = fabs (tx) + fabs (ty);
-              break;
-            }
-
-          if (d &lt; brush-&gt;radius + 1)
-            a = lookup[(gint) rint (d * OVERSAMPLING)];
-          else
-            a = 0;
-
-          centerp[ y * brush-&gt;mask-&gt;get_width() + x] = a;
-
-          if (brush-&gt;spikes % 2 == 0)
-            centerp[-1 * y * brush-&gt;mask-&gt;get_width() - x] = a;
-        }
-    }
-
-  delete lookup;
-}
-
-GrayscaleBuffer* generate_brushmask(BrushShape shape,
-                                    float  radius,
-                                    int    spikes,        /* 2 - 20     */
-                                    float  hardness,      /* 0.0 - 1.0  */
-                                    float  aspect_ratio,  /* y/x        */
-                                    float  angle)         /* in degrees */
-{
-  GimpBrushGenerated brush;
-  
-  brush.mask         = 0;
-  brush.shape        = shape;
-  brush.radius       = radius;
-  brush.spikes       = spikes;
-  brush.hardness     = hardness;
-  brush.aspect_ratio = aspect_ratio;
-  brush.angle        = angle;
-
-  gimp_brush_generated_dirty(&amp;brush);
-
-  return brush.mask;
-}
-
-#ifdef TEST
-int main()
-{
-  GimpBrushGenerated brush;
-  
-  brush.mask         = 0;
-  brush.shape        = BRUSH_SHAPE_DIAMOND;
-  brush.radius       = 512;
-  brush.spikes       = 19;
-  brush.hardness     = 0.9;
-  brush.aspect_ratio = 1;
-  brush.angle        = 0;
-
-  gimp_brush_generated_dirty(&amp;brush);
-
-  std::cout &lt;&lt; &quot;P2\n&quot;;
-  std::cout &lt;&lt; &quot;# Gimp Brush Generator\n&quot;;
-  std::cout &lt;&lt; brush.mask-&gt;width &lt;&lt; &quot; &quot; &lt;&lt; brush.mask-&gt;height &lt;&lt; &quot;\n&quot;;
-  std::cout &lt;&lt; &quot;255\n&quot;;
-
-  for (int i = 0; i &lt; brush.mask-&gt;width * brush.mask-&gt;height; ++i)
-    std::cout &lt;&lt; int(brush.mask-&gt;data[i]) &lt;&lt; &quot; &quot;;
-
-  //temp_buf_free(brush.mask);
-  
-  std::cout &lt;&lt; std::endl;
-
-  return 0;
-}
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/brushmask.hpp
===================================================================
--- trunk/netbrush/brushmask.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/brushmask.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,45 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_BRUSHMASK_HPP
-#define HEADER_BRUSHMASK_HPP
-
-#include &quot;grayscale_buffer.hpp&quot;
-
-enum BrushShape {
-  BRUSH_SHAPE_CIRCLE,
-  BRUSH_SHAPE_SQUARE,
-  BRUSH_SHAPE_DIAMOND
-};
-
-GrayscaleBuffer* generate_brushmask(BrushShape shape,
-                                    float  radius,
-                                    int    spikes,        /* 2 - 20     */
-                                    float  hardness,      /* 0.0 - 1.0  */
-                                    float  aspect_ratio,  /* y/x (1.0f - 20.0f)       */
-                                    float  angle);        /* in degrees */
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/client.cpp
===================================================================
--- trunk/netbrush/client.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/client.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,363 +0,0 @@
-#include &lt;iostream&gt;
-#include &lt;sstream&gt;
-#include &lt;map&gt;
-#include &quot;math/rect.hpp&quot;
-#include &quot;stroke.hpp&quot;
-#include &quot;SDL.h&quot;
-#include &quot;SDL_main.h&quot;
-#include &quot;SDL_image.h&quot;
-#include &quot;SDL_net.h&quot;
-#include &quot;drawing_context.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;debug.hpp&quot;
-#include &quot;video.hpp&quot;
-#include &quot;client_state.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;screen_buffer.hpp&quot;
-#include &quot;stroke_buffer.hpp&quot;
-#include &quot;widget/widget_manager.hpp&quot;
-#include &quot;widget/scrollbar.hpp&quot;
-#include &quot;widget/button.hpp&quot;
-#include &quot;saturation_value_picker.hpp&quot;
-#include &quot;hue_picker.hpp&quot;
-#include &quot;alpha_picker.hpp&quot;
-#include &quot;brush_widget.hpp&quot;
-#include &quot;navigation.hpp&quot;
-#include &quot;server_connection.hpp&quot;
-#include &quot;widget/slider_widget.hpp&quot;
-
-SDL_Rect* make_rect(int x, int y, int w, int h)
-{
-  static SDL_Rect rect;
-  rect.x = x;
-  rect.y = y;
-  rect.w = w;
-  rect.h = h;
-  return &rect;
-}
-
-void process_events()
-{
-  SDL_Event event;
-  
-  while(SDL_PollEvent(&amp;event))
-    {
-      switch(event.type)
-        {
-        case SDL_QUIT:
-          puts(&quot;# quit&quot;);
-          exit(0);
-          break;
-
-        case SDL_KEYDOWN:
-          if (event.key.keysym.sym == SDLK_1)
-            {
-              client_draw_param-&gt;set_brush(&quot;brush_2x2.png&quot;);
-            }
-          else if (event.key.keysym.sym == SDLK_2)
-            {
-              client_draw_param-&gt;set_brush(&quot;brush_white_2x2.png&quot;);
-            }
-          else if (event.key.keysym.sym == SDLK_3)
-            {
-              client_draw_param-&gt;set_brush(&quot;brush_3x3.png&quot;);
-            }
-          else if (event.key.keysym.sym == SDLK_4)
-            {
-              client_draw_param-&gt;set_brush(&quot;brush_white_3x3.png&quot;);
-            }
-          else if (event.key.keysym.sym == SDLK_5)
-            {
-              client_draw_param-&gt;set_brush(&quot;brush_14x14.png&quot;);
-            }
-          else if (event.key.keysym.sym == SDLK_6)
-            {
-              client_draw_param-&gt;set_brush(&quot;brush_white_14x14.png&quot;);
-            }
-          else if (event.key.keysym.sym == SDLK_k)
-            {
-              std::cout &lt;&lt; &quot;Forced screen clear and update&quot; &lt;&lt; std::endl;
-              SDL_FillRect(screen, NULL, SDL_MapRGB(screen-&gt;format, 255, 0, 255));
-              SDL_UpdateRect(screen, 0, 0, 0, 0);
-            }
-          else if (event.key.keysym.sym == SDLK_j)
-            {
-              std::cout &lt;&lt; &quot;Forced screen update&quot; &lt;&lt; std::endl;
-              SDL_UpdateRect(screen, 0, 0, 0, 0);
-            }
-          else if (event.key.keysym.sym == SDLK_c)
-            {
-              server-&gt;send(&quot;clear\n&quot;);
-            }
-          else if (event.key.keysym.sym == SDLK_INSERT)
-            {
-              client_draw_param-&gt;color.r = std::min(255, client_draw_param-&gt;color.r + 32);
-            }
-          else if (event.key.keysym.sym == SDLK_DELETE)
-            {
-              client_draw_param-&gt;color.r = std::max(0, client_draw_param-&gt;color.r - 32);
-            }
-          else if (event.key.keysym.sym == SDLK_HOME)
-            {
-              client_draw_param-&gt;color.g = std::min(255, client_draw_param-&gt;color.g + 32);
-            }
-          else if (event.key.keysym.sym == SDLK_END)
-            {
-              client_draw_param-&gt;color.g = std::max(0, client_draw_param-&gt;color.g - 32);
-            }
-          else if (event.key.keysym.sym == SDLK_PAGEUP)
-            {
-              client_draw_param-&gt;color.b = std::min(255, client_draw_param-&gt;color.b + 32);
-            }
-          else if (event.key.keysym.sym == SDLK_PAGEDOWN)
-            {
-              client_draw_param-&gt;color.b = std::max(0, client_draw_param-&gt;color.b - 32);
-            }
-          else if (event.key.keysym.sym == SDLK_UP)
-            {
-              client_draw_param-&gt;opacity = std::max(0, client_draw_param-&gt;opacity - 16);
-            }
-          else if (event.key.keysym.sym == SDLK_DOWN)
-            {
-              client_draw_param-&gt;opacity = std::min(255, client_draw_param-&gt;opacity + 16);
-            }
-          else if (event.key.keysym.sym == SDLK_u)
-            {
-              navigation-&gt;update();
-            }
-          break;
-
-        case SDL_MOUSEBUTTONDOWN:
-          widget_manager-&gt;on_mouse_button(event.button);
-          break;
-
-        case SDL_MOUSEBUTTONUP:
-          widget_manager-&gt;on_mouse_button(event.button);
-          break;
-
-        case SDL_MOUSEMOTION:
-          widget_manager-&gt;on_mouse_motion(event.motion);
-          break;
-        }
-    }  
-}
-
-class RadiusCallback : public SliderCallback
-{
-public:
-  void operator()(float v) 
-  {
-    float radius = v * 100.0f + 0.1f;
-    client_draw_param-&gt;generic_brush.radius = radius;
-    //std::cout &lt;&lt; &quot;Radius: &quot; &lt;&lt; radius &lt;&lt; std::endl;
-    brush_widget-&gt;set_brush(client_draw_param-&gt;generic_brush);
-  }
-};
-
-class SpikeCallback : public SliderCallback
-{
-public:
-  void operator()(float v) 
-  {
-    int spikes = int(v*18) + 2;
-    //std::cout &lt;&lt; &quot;Spike: &quot; &lt;&lt; spikes &lt;&lt; std::endl;
-    client_draw_param-&gt;generic_brush.spikes = spikes;    
-    brush_widget-&gt;set_brush(client_draw_param-&gt;generic_brush);
-  }
-};
-
-class HardnessCallback : public SliderCallback
-{
-public:
-  void operator()(float v) 
-  {
-    float hardness = v;
-    client_draw_param-&gt;generic_brush.hardness = hardness;
-    //std::cout &lt;&lt; &quot;Hardness: &quot; &lt;&lt; hardness &lt;&lt; std::endl;
-    brush_widget-&gt;set_brush(client_draw_param-&gt;generic_brush);
-  }
-};
-
-class AspectRatioCallback : public SliderCallback
-{
-public:
-  void operator()(float v) 
-  {
-    float aspect_ratio = v*19.0f + 1.0f;
-    client_draw_param-&gt;generic_brush.aspect_ratio = aspect_ratio;
-    //std::cout &lt;&lt; &quot;Aspect_Ratio: &quot; &lt;&lt; aspect_ratio &lt;&lt; std::endl;
-    brush_widget-&gt;set_brush(client_draw_param-&gt;generic_brush);
-  }
-};
-
-class AngleCallback : public SliderCallback
-{
-public:
-  void operator()(float v) 
-  {
-    float angle = v * 360.0f;
-    client_draw_param-&gt;generic_brush.angle = angle;
-    //std::cout &lt;&lt; &quot;Angle: &quot; &lt;&lt; angle &lt;&lt; std::endl;
-    brush_widget-&gt;set_brush(client_draw_param-&gt;generic_brush);
-  }
-};
-
-class ToolButtonCallback : public ButtonCallback
-{
-private:
-  DrawingParameter::Tool tool;
-public:
-  ToolButtonCallback(DrawingParameter::Tool tool_)
-    : tool(tool_)
-  {
-  }
-
-  void on_press  (Button* button) 
-  {
-    std::cout &lt;&lt; &quot;Press: &quot; &lt;&lt; button &lt;&lt; std::endl;
-  }
-
-  void on_release(Button* button) 
-  {
-    std::cout &lt;&lt; &quot;Release: &quot; &lt;&lt; button &lt;&lt; std::endl;
-  }
-  
-  void on_click  (Button* button) 
-  {
-    std::cout &lt;&lt; &quot;Setting tool: &quot; &lt;&lt; tool &lt;&lt; std::endl;
-    client_draw_param-&gt;tool = tool;
-  }
-};
-
-int main(int argc, char** argv)
-{
-  if(SDL_Init(SDL_INIT_VIDEO)== -1) {
-    printf(&quot;SDL_Init: %s\n&quot;, SDL_GetError());
-    exit(1);
-  }
-  atexit(SDL_Quit);
-
-  if(SDLNet_Init()==-1) {
-    printf(&quot;SDLNet_Init: %s\n&quot;, SDLNet_GetError());
-    exit(2);
-  }
-  atexit(SDLNet_Quit);
-
-  screen = SDL_SetVideoMode(1024, 768, 32, SDL_HWSURFACE); 
-  if (screen == 0)
-    printf(&quot;SDL_SetVideoMode: %s\n&quot;, SDL_GetError());
-  SDL_WM_SetCaption(&quot;netBrush&quot;, &quot;netBrush&quot;);
-
-  // 18 is scrollbar
-  screen_buffer = new ScreenBuffer(Rect(38, 2, screen-&gt;w - 128 - 16 - 18, screen-&gt;h - 16 - 4)); 
-  draw_ctx      = new DrawingContext(2048, 2048);
-  stroke_buffer = new StrokeBuffer(2048, 2048);
-
-  std::cout &lt;&lt; &quot;# clear screen&quot; &lt;&lt; std::endl;
-
-  // clear screen
-  draw_ctx-&gt;clear();
-
-  std::cout &lt;&lt; &quot;# clear screen done&quot; &lt;&lt; std::endl;
-
-  client_draw_param = new DrawingParameter();
-  stroke_buffer-&gt;set_param(client_draw_param);
-  
-  server = new ServerConnection();
-  if (argc == 3)
-    {
-      std::cout &lt;&lt; &quot;# connecting to: &quot; &lt;&lt; argv[1] &lt;&lt; &quot;:&quot; &lt;&lt; atoi(argv[2]) &lt;&lt; std::endl;
-      server-&gt;connect(argv[1], atoi(argv[2]));
-      std::ostringstream title_line;
-      title_line &lt;&lt; &quot;netBrush - online: &quot; &lt;&lt; argv[1] &lt;&lt; &quot;:&quot; &lt;&lt; atoi(argv[2]);
-      SDL_WM_SetCaption(title_line.str().c_str(), &quot;netBrush&quot;);
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;# use '&quot; &lt;&lt; argv[0] &lt;&lt; &quot; HOSTNAME PORT' to connect a networking session&quot; &lt;&lt; std::endl;
-      SDL_WM_SetCaption(&quot;netBrush - offline mode&quot;, &quot;netBrush&quot;);
-    }
-  
-  widget_manager = new WidgetManager();
-  widget_manager-&gt;add(navigation = new Navigation(Rect(Point(screen-&gt;w - 128 - 2, screen-&gt;h - 128 - 2),
-                                                       Size(128, 128))));
-  widget_manager-&gt;add(new Button(IMG_Load(&quot;data/icons/stock-tool-airbrush-22.png&quot;), 
-                                 Rect(Point(2, 2+0*34), Size(34, 34)),
-                                 new ToolButtonCallback(DrawingParameter::TOOL_AIRBRUSH)));
-  widget_manager-&gt;add(new Button(IMG_Load(&quot;data/icons/stock-tool-paintbrush-22.png&quot;), 
-                                 Rect(Point(2, 2+1*34), Size(34, 34)),
-                                 new ToolButtonCallback(DrawingParameter::TOOL_PAINTBRUSH)));
-  if (0)
-    widget_manager-&gt;add(new Button(IMG_Load(&quot;data/icons/stock-tool-zoom-22.png&quot;), 
-                                   Rect(Point(2, 2+2*34), Size(34, 34)),
-                                   new ToolButtonCallback(DrawingParameter::TOOL_PAINTBRUSH)));
-
-  {
-    SDL_Rect color_rect;
-    color_rect.x = 768;
-    color_rect.y = 100;
-
-    color_rect.w = 128;
-    color_rect.h = 128;
-
-    //widget_manager-&gt;add(new ColorSelector(&amp;color_rect));
-  }
-
-  widget_manager-&gt;add(screen_buffer);
-
-  widget_manager-&gt;add(vertical_scrollbar = 
-                      new Scrollbar(0, 2048, screen_buffer-&gt;get_rect().get_height(), Scrollbar::VERTICAL,
-                                    Rect(screen-&gt;w - 128 - 16 - 16, 2,
-                                         screen-&gt;w - 128 - 16, screen-&gt;h - 16 - 4)));
-
-  widget_manager-&gt;add(horizontal_scrollbar = 
-                      new Scrollbar(0, 2048, screen_buffer-&gt;get_rect().get_width(), Scrollbar::HORIZONTAL,
-                                    Rect(38, screen-&gt;h - 16 - 2,
-                                         screen-&gt;w - 128 - 16 - 18, screen-&gt;h - 2)));
-
-  alpha_picker = new AlphaPicker(Rect(Point(screen-&gt;w-128, 128+24), Size(128, 24)));
-  saturation_value_picker = new SaturationValuePicker(Rect(Point(screen-&gt;w-128, 0), Size(128, 128)));
-  hue_picker   = new HuePicker(Rect(Point(screen-&gt;w-128, 128), Size(128, 24)));
-
-  brush_widget = new BrushWidget(Rect(Point(screen-&gt;w-128, 128+24+24), Size(128, 128)));
-  brush_widget-&gt;set_brush(client_draw_param-&gt;generic_brush);
-
-  SliderWidget* radius_slider = new SliderWidget(Rect(Point(screen-&gt;w-128, 128+24+24+128+24*(0)), Size(128, 24)),
-                                                 new RadiusCallback());
-  widget_manager-&gt;add(radius_slider);
-
-  SliderWidget* spike_slider = new SliderWidget(Rect(Point(screen-&gt;w-128, 128+24+24+128+24*(1)), Size(128, 24)),
-                                                 new SpikeCallback());
-  widget_manager-&gt;add(spike_slider);
-
-  SliderWidget* hardness_slider = new SliderWidget(Rect(Point(screen-&gt;w-128, 128+24+24+128+24*(2)), Size(128, 24)),
-                                                 new HardnessCallback());
-  widget_manager-&gt;add(hardness_slider);
-
-  SliderWidget* aspect_ratio_slider = new SliderWidget(Rect(Point(screen-&gt;w-128, 128+24+24+128+24*(3)), Size(128, 24)),
-                                                 new AspectRatioCallback());
-  widget_manager-&gt;add(aspect_ratio_slider);
-
-  SliderWidget* angle_slider = new SliderWidget(Rect(Point(screen-&gt;w-128, 128+24+24+128+24*(4)), Size(128, 24)),
-                                                 new AngleCallback());
-  widget_manager-&gt;add(angle_slider);
-
-  widget_manager-&gt;add(saturation_value_picker);
-  widget_manager-&gt;add(hue_picker);
-  widget_manager-&gt;add(alpha_picker);
-  widget_manager-&gt;add(brush_widget);
-
-  // Main Loop
-  while(true)
-    {
-      process_events();
-      server-&gt;update();
-      widget_manager-&gt;update();
-      SDL_Delay(10);
-    }
-  
-  return 0;
-}
-
-/* EOF */
-

Deleted: trunk/netbrush/client_state.cpp
===================================================================
--- trunk/netbrush/client_state.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/client_state.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,122 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;drawing_context.hpp&quot;
-#include &quot;stroke.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;client_state.hpp&quot;
-
-ClientState::ClientState(int id_)
-  :id(id_), current_stroke(0), draw_param(0)
-{    
-  draw_param = new DrawingParameter();
-}
-
-ClientState::~ClientState()
-{
-  delete draw_param;
-  delete current_stroke; 
-}
-
-void
-ClientState::set_tool(DrawingParameter::Tool tool)
-{
-  draw_param-&gt;tool = tool;
-}
-
-void
-ClientState::set_color(const Color&amp; color)
-{
-  draw_param-&gt;color = color;
-}
-
-void
-ClientState::set_opacity(Uint8 o)
-{
-  draw_param-&gt;opacity = o;
-}
-
-void
-ClientState::set_brush(const std::string&amp; filename) 
-{
-  draw_param-&gt;set_brush(filename);
-}
-
-void
-ClientState::set_generic_brush(BrushShape shape,
-                               float  radius,
-                               int    spikes,        /* 2 - 20     */
-                               float  hardness,      /* 0.0 - 1.0  */
-                               float  aspect_ratio,  /* y/x (1.0f - 20.0f)       */
-                               float  angle)
-{
-  draw_param-&gt;generic_brush.shape        = shape;
-  draw_param-&gt;generic_brush.radius       = radius;
-  draw_param-&gt;generic_brush.spikes       = spikes;
-  draw_param-&gt;generic_brush.hardness     = hardness;
-  draw_param-&gt;generic_brush.aspect_ratio = aspect_ratio;
-  draw_param-&gt;generic_brush.angle        = angle;
-  
-  draw_param-&gt;brush_file = &quot;&quot;;
-  delete draw_param-&gt;brush_buffer;
-  draw_param-&gt;brush_buffer = draw_param-&gt;generic_brush.generate();
-}
-
-void
-ClientState::stroke_begin() {
-  //std::cout &lt;&lt; &quot;CL&quot; &lt;&lt; id &lt;&lt; &quot; stroke_begin&quot; &lt;&lt; std::endl;
-  current_stroke = new Stroke();
-}
-
-void
-ClientState::stroke_end() {
-  //std::cout &lt;&lt; &quot;CL&quot; &lt;&lt; id &lt;&lt; &quot; stroke_end&quot; &lt;&lt; std::endl;
-  if (current_stroke)
-    {
-      //std::cout &lt;&lt; &quot;# drawing stroke&quot; &lt;&lt; std::endl;
-      draw_ctx-&gt;draw_stroke(*current_stroke, draw_param);
-
-      delete current_stroke;
-      current_stroke = 0;
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;# got stroke_end before stroke_begin&quot; &lt;&lt; std::endl;
-    }
-}
-
-void
-ClientState::dab(unsigned int time, int x, int y) 
-{
-  //std::cout &lt;&lt; &quot;CL&quot; &lt;&lt; id &lt;&lt; &quot; dab &quot; &lt;&lt; time &lt;&lt; &quot; &quot; &lt;&lt; x &lt;&lt; &quot; &quot; &lt;&lt; y &lt;&lt; std::endl;
-  if (current_stroke)
-    {
-      current_stroke-&gt;add_dab(Dab(x, y));
-    }
-}
-
-/* EOF */

Deleted: trunk/netbrush/client_state.hpp
===================================================================
--- trunk/netbrush/client_state.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/client_state.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,66 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_CLIENT_STATE_HPP
-#define HEADER_CLIENT_STATE_HPP
-
-#include &lt;string&gt;
-#include &quot;brushmask.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-
-class Color;
-class Stroke;
-class DrawingParameter;
-
-class ClientState
-{
-private:
-  int id;
-  Stroke* current_stroke;
-  DrawingParameter* draw_param;
-
-public:
-  ClientState(int id_);
-  ~ClientState();
-
-  void set_tool(DrawingParameter::Tool tool);
-  void set_opacity(Uint8 o);
-  void set_color(const Color&amp; color);
-  void set_generic_brush(BrushShape shape,
-                         float  radius,
-                         int    spikes,        /* 2 - 20     */
-                         float  hardness,      /* 0.0 - 1.0  */
-                         float  aspect_ratio,  /* y/x (1.0f - 20.0f)       */
-                         float  angle);
-  void set_brush(const std::string&amp; filename);
-  void stroke_begin();
-  void stroke_end();
-
-  void dab(unsigned int time, int x, int y);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/color.hpp
===================================================================
--- trunk/netbrush/color.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/color.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,48 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_COLOR_HPP
-#define HEADER_COLOR_HPP
-
-#include &quot;SDL.h&quot;
-
-struct Color
-{
-  Color()
-    : r(0), g(0), b(0)
-  {}
-
-  Color(Uint8 r_, Uint8 g_, Uint8 b_)
-    : r(r_), g(g_), b(b_)
-  {}
-
-  Uint8 r;
-  Uint8 g;
-  Uint8 b;
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/debug.cpp
===================================================================
--- trunk/netbrush/debug.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/debug.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,39 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;debug.hpp&quot;
-
-void client_error(const std::string&amp; msg)
-{
-  std::cout &lt;&lt; &quot;# ERROR: &quot; &lt;&lt; msg &lt;&lt; std::endl;
-}
-
-void client_notice(const std::string&amp; msg)
-{
-  std::cout &lt;&lt; &quot;# notice: &quot; &lt;&lt; msg &lt;&lt; std::endl;
-}
-
-/* EOF */

Deleted: trunk/netbrush/debug.hpp
===================================================================
--- trunk/netbrush/debug.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/debug.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,36 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_DEBUG_HPP
-#define HEADER_DEBUG_HPP
-
-#include &lt;string&gt;
-
-void client_error(const std::string&amp; msg);
-void client_notice(const std::string&amp; msg);
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/drawing_context.cpp
===================================================================
--- trunk/netbrush/drawing_context.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/drawing_context.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,162 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;globals.hpp&quot;
-#include &quot;screen_buffer.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;video.hpp&quot;
-#include &quot;grayscale_buffer.hpp&quot;
-#include &quot;stroke_buffer.hpp&quot;
-#include &quot;navigation.hpp&quot;
-#include &quot;drawing_context.hpp&quot;
-
-DrawingContext::DrawingContext(int w, int h) 
-{
-  Uint32 rmask, gmask, bmask, amask;
-
-  /* SDL interprets each pixel as a 32-bit number, so our masks must depend
-     on the endianness (byte order) of the machine */
-#if SDL_BYTEORDER == SDL_BIG_ENDIAN
-  rmask = 0xff000000;
-  gmask = 0x00ff0000;
-  bmask = 0x0000ff00;
-  amask = 0; //0x000000ff;
-#else
-  rmask = 0x000000ff;
-  gmask = 0x0000ff00;
-  bmask = 0x00ff0000;
-  amask = 0; //0xff000000;
-#endif
-
-  drawable = SDL_CreateRGBSurface(SDL_SWSURFACE, w, h, 24,
-                                  rmask, gmask, bmask, amask);
-  if(drawable == NULL) {
-    fprintf(stderr, &quot;CreateRGBSurface failed: %s\n&quot;, SDL_GetError());
-    exit(1);
-  }
-
-  stroke_buffer = new StrokeBuffer(w, h);
-}
-
-DrawingContext::~DrawingContext() 
-{
-  SDL_FreeSurface(drawable);
-}
-
-void
-DrawingContext::draw_stroke(const Stroke&amp; stroke, DrawingParameter* param)
-{
-  Rect rect = stroke.get_bounding_rect();
-
-  rect.left -= param-&gt;thickness()/2;
-  rect.top  -= param-&gt;thickness()/2;
-  
-  rect.right  += param-&gt;thickness()/2;
-  rect.bottom += param-&gt;thickness()/2;
-
-  clip_to(rect, Rect(0, 0, get_width(), get_height()));
-
-  stroke_buffer-&gt;clear(rect);
-  stroke_buffer-&gt;set_param(param);
-  stroke_buffer-&gt;draw_stroke(stroke, param);
-  stroke_buffer-&gt;draw(drawable, rect, 0, 0);
-
-  screen_buffer-&gt;mark_dirty(rect);
-
-  // FIXME: Limit this to what changed on the buffer instead of whole screen
-  navigation-&gt;update();
-}
-
-void
-DrawingContext::clear()
-{
-  SDL_Rect rect;
-  
-  rect.x = 0;
-  rect.y = 0;
-  rect.w = drawable-&gt;w;
-  rect.h = drawable-&gt;h;
-
-  SDL_FillRect(drawable, &amp;rect, SDL_MapRGB(drawable-&gt;format, 255, 255, 255));
-
-  screen_buffer-&gt;mark_dirty(Rect(Point(0,0), Size(rect.w, rect.h)));
-}
-
-void
-DrawingContext::draw(SDL_Surface* target_surf, const Rect&amp; rect, int x_of, int y_of)
-{
-  // rect is in screenspace, x_of, y_of tell how to go from canvas to screenspace
-
-  if (1) // no zoom
-    {
-      SDL_Rect target_pos;
-      target_pos.x = rect.left;
-      target_pos.y = rect.top;
-      target_pos.w = rect.get_width();
-      target_pos.h = rect.get_height();
-
-      SDL_Rect source_pos;
-      source_pos.x = rect.left - x_of;
-      source_pos.y = rect.top  - y_of;
-      source_pos.w = rect.get_width();
-      source_pos.h = rect.get_height();
-
-      SDL_Rect r;
-      r.x = 0;
-      r.y = 0;
-      r.w = drawable-&gt;w;
-      r.h = drawable-&gt;h;
-
-      clip_to(&amp;source_pos, &amp;r);
-      SDL_BlitSurface(drawable, &amp;source_pos, target_surf, &amp;target_pos);
-    }
-  else
-    {
-      SDL_LockSurface(target_surf);
-      SDL_LockSurface(drawable);
-
-      Uint8* target = static_cast&lt;Uint8*&gt;(target_surf-&gt;pixels);
-      Uint8* source = static_cast&lt;Uint8*&gt;(drawable-&gt;pixels);
-
-      // FIXME: do clipping or do clipping at a higher level in the code
-      float zoom = 2.0f;
-      for(int y = rect.top; y &lt; rect.bottom; ++y)
-        for(int x = rect.left; x &lt; rect.right; ++x)
-          {
-            int sx = int(x * zoom);
-            int sy = int(y * zoom);
-
-            target[y * target_surf-&gt;pitch + target_surf-&gt;format-&gt;BytesPerPixel * x + 2] = source[sy * drawable-&gt;pitch + drawable-&gt;format-&gt;BytesPerPixel * sx + 0];
-            target[y * target_surf-&gt;pitch + target_surf-&gt;format-&gt;BytesPerPixel * x + 1] = source[sy * drawable-&gt;pitch + drawable-&gt;format-&gt;BytesPerPixel * sx + 1];
-            target[y * target_surf-&gt;pitch + target_surf-&gt;format-&gt;BytesPerPixel * x + 0] = source[sy * drawable-&gt;pitch + drawable-&gt;format-&gt;BytesPerPixel * sx + 2];
-          }
-
-      SDL_UnlockSurface(drawable);
-      SDL_UnlockSurface(target_surf);
-    }
-}
-
-/* EOF */

Deleted: trunk/netbrush/drawing_context.hpp
===================================================================
--- trunk/netbrush/drawing_context.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/drawing_context.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,61 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_DRAWING_CONTEXT_HPP
-#define HEADER_DRAWING_CONTEXT_HPP
-
-#include &quot;SDL.h&quot;
-#include &quot;math/rect.hpp&quot;
-#include &quot;stroke.hpp&quot;
-
-class GrayscaleBuffer;
-class DrawingParameter;
-class StrokeBuffer;
-
-class DrawingContext
-{
-private:
-  SDL_Surface*     drawable;
-  StrokeBuffer*    stroke_buffer;
- 
-public:
-  DrawingContext(int w, int h);
-  ~DrawingContext();
-
-  void draw_stroke(const Stroke&amp; stroke, DrawingParameter* param); 
-
-  void clear();
-
-  void draw(SDL_Surface* target, const Rect&amp; region, int x_of, int y_of);
-
-  int get_width()  const { return drawable-&gt;w; }
-  int get_height() const { return drawable-&gt;h; }
-
-  SDL_Surface* get_surface() { return drawable; }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/drawing_parameter.cpp
===================================================================
--- trunk/netbrush/drawing_parameter.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/drawing_parameter.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,91 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &quot;grayscale_buffer.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-
-DrawingParameter::DrawingParameter()
-  : tool(TOOL_PAINTBRUSH),
-    brush_surface(0), 
-    brush_buffer(0), 
-    color(0, 0, 0), 
-    opacity(128),
-    spacing(1.0f)
-{
-  set_brush(&quot;brush_3x3.png&quot;);
-}
-
-void
-DrawingParameter::set_brush(const std::string&amp; filename)
-{
-  SDL_Surface* new_brush = IMG_Load(filename.c_str());
-  if (new_brush)
-    {
-      if (brush_surface)
-        SDL_FreeSurface(brush_surface);
-
-      brush_surface = new_brush;
-      brush_file    = filename;  
-
-      delete brush_buffer;
-      brush_buffer = new GrayscaleBuffer(brush_surface);
-    }
-  else
-    {
-      client_error(&quot;Couldn't load file &quot; + filename);
-    }
-}
-
-std::string
-DrawingParameter::get_brush() const 
-{
-  return brush_file;
-}
-
-SDL_Surface*
-DrawingParameter::get_brush_surface() const 
-{ 
-  return brush_surface;
-}
-
-GrayscaleBuffer*
-DrawingParameter::get_brush_buffer() const
-{
-  return brush_buffer;
-}
-
-int
-DrawingParameter::thickness() const
-{
-  return brush_buffer-&gt;get_width();
-}
-
-float
-DrawingParameter::get_spacing()
-{
-  return brush_buffer-&gt;get_width() * spacing / 12.0f;
-}
-
-/* EOF */

Deleted: trunk/netbrush/drawing_parameter.hpp
===================================================================
--- trunk/netbrush/drawing_parameter.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/drawing_parameter.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,63 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_DRAWING_PARAMETER_HPP
-#define HEADER_DRAWING_PARAMETER_HPP
-
-#include &quot;SDL.h&quot;
-#include &quot;SDL_image.h&quot;
-#include &quot;debug.hpp&quot;
-#include &quot;color.hpp&quot;
-#include &quot;generic_brush.hpp&quot;
-
-class GrayscaleBuffer;
-
-class DrawingParameter
-{
-public:
-  enum Tool { TOOL_AIRBRUSH, TOOL_PAINTBRUSH };
-  Tool             tool;
-  std::string      brush_file;
-  GenericBrush     generic_brush;
-  SDL_Surface*     brush_surface;
-  GrayscaleBuffer* brush_buffer;
-  Color            color;
-  Uint8            opacity;
-  float            spacing;
-  
-public:
-  DrawingParameter();
-
-  float get_spacing();
-  void set_brush(const std::string&amp; filename);
-  std::string get_brush() const;
-  SDL_Surface* get_brush_surface() const;
-  GrayscaleBuffer* get_brush_buffer() const;
-  int thickness() const;
-};
-
-#endif 
-
-/* EOF */

Deleted: trunk/netbrush/generic_brush.cpp
===================================================================
--- trunk/netbrush/generic_brush.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/generic_brush.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,34 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &quot;generic_brush.hpp&quot;
-
-GrayscaleBuffer*
-GenericBrush::generate()
-{
-  return generate_brushmask(shape, radius, spikes, hardness, aspect_ratio, angle);
-}
-
-/* EOF */

Deleted: trunk/netbrush/generic_brush.hpp
===================================================================
--- trunk/netbrush/generic_brush.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/generic_brush.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,55 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_GENERIC_BRUSH_HPP
-#define HEADER_GENERIC_BRUSH_HPP
-
-#include &quot;brushmask.hpp&quot;
-
-class GenericBrush
-{
-public:
-  BrushShape shape;
-  float      radius;
-  int        spikes;        /* 2 - 20     */
-  float      hardness;      /* 0.0 - 1.0  */
-  float      aspect_ratio;  /* y/x (1.0f - 20.0f) */
-  float      angle;         /* in degrees */
-  
-  GenericBrush()
-    : shape(BRUSH_SHAPE_CIRCLE),
-      radius(10),
-      spikes(2),
-      hardness(0.5),
-      aspect_ratio(1.0f),
-      angle(0.0f)
-  {}
-
-  GrayscaleBuffer* generate();
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/globals.cpp
===================================================================
--- trunk/netbrush/globals.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/globals.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,48 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &quot;globals.hpp&quot;
-
-DrawingContext*   draw_ctx          = 0;
-DrawingParameter* client_draw_param = 0;
-ScreenBuffer*     screen_buffer     = 0;
-StrokeBuffer*     stroke_buffer     = 0;
-WidgetManager*    widget_manager    = 0;
-
-std::map&lt;int, ClientState*&gt; client_states;
-
-SaturationValuePicker* saturation_value_picker =0;
-HuePicker*   hue_picker =0;
-AlphaPicker*      alpha_picker = 0;
-BrushWidget*      brush_widget = 0;
-Stroke*           current_stroke = 0;
-ServerConnection* server = 0;
-
-Scrollbar* horizontal_scrollbar = 0;
-Scrollbar* vertical_scrollbar   = 0;
-
-Navigation* navigation = 0;
-
-/* EOF */

Deleted: trunk/netbrush/globals.hpp
===================================================================
--- trunk/netbrush/globals.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/globals.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,72 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_GLOBALS_HPP
-#define HEADER_GLOBALS_HPP
-
-#include &quot;SDL_net.h&quot;
-
-#include &lt;map&gt;
-#include &lt;vector&gt;
-#include &lt;string&gt;
-
-class StrokeBuffer;
-class ScreenBuffer;
-class Stroke;
-class ClientState;
-class DrawingContext;
-class DrawingParameter;
-class WidgetManager;
-class SaturationValuePicker;
-class HuePicker;
-class AlphaPicker;
-class BrushWidget;
-class ServerConnection;
-class Scrollbar;
-class Navigation;
-
-extern SDLNet_SocketSet socketset;
-
-extern Scrollbar* horizontal_scrollbar;
-extern Scrollbar* vertical_scrollbar;
-extern BrushWidget* brush_widget;
-extern DrawingContext*   draw_ctx;
-extern DrawingParameter* client_draw_param;
-extern std::map&lt;int, ClientState*&gt; client_states;
-extern ScreenBuffer*     screen_buffer;
-extern StrokeBuffer*     stroke_buffer;
-extern WidgetManager* widget_manager;
-
-extern SaturationValuePicker* saturation_value_picker;
-extern HuePicker*   hue_picker;
-extern AlphaPicker* alpha_picker;
-extern ServerConnection* server;
-extern Stroke* current_stroke;
-
-extern Navigation* navigation;
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/graphic_context_state.cpp
===================================================================
--- trunk/netbrush/graphic_context_state.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/graphic_context_state.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,201 +0,0 @@
-//  $Id$
-//
-//  Flexlay - A Generic 2D Game Editor
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;math.h&gt;
-#include &quot;graphic_context_state.hpp&quot;
-
-class GraphicContextStateImpl
-{
-public:
-  int width;
-  int height;
-  
-  Vector offset;
-  float zoom;
-  float rotation;
-};
-
-GraphicContextState::GraphicContextState()
-  : impl(new GraphicContextStateImpl())
-{
-  impl-&gt;width  = 1;
-  impl-&gt;height = 1; 
-  impl-&gt;offset = Vector(0,0);
-  impl-&gt;zoom   = 1.0f;
-  impl-&gt;rotation = 0;
-}
-
-GraphicContextState::GraphicContextState(int w, int h)
-  : impl(new GraphicContextStateImpl())
-{  
-  impl-&gt;width  = w;
-  impl-&gt;height = h;
-  impl-&gt;offset = Vector(0,0); 
-  impl-&gt;zoom   = 1.0f;
-  impl-&gt;rotation = 0;
-}
-
-void
-GraphicContextState::set_size(int w, int h)
-{
-  impl-&gt;width  = w;
-  impl-&gt;height = h;
-}
-
-#if 0
-void
-GraphicContextState::push(CL_GraphicContext* gc)
-{
-  if (gc == 0)
-    gc = CL_Display::get_current_window()-&gt;get_gc();
-  
-  gc-&gt;push_modelview();
-
-  gc-&gt;add_translate(impl-&gt;width/2, impl-&gt;height/2);
-  gc-&gt;add_rotate(impl-&gt;rotation, 0, 0, 1.0);
-  gc-&gt;add_translate(-impl-&gt;width/2, -impl-&gt;height/2);
-
-  gc-&gt;add_scale(get_zoom(), get_zoom());
-  gc-&gt;add_translate(impl-&gt;offset.x, impl-&gt;offset.y);
-}
-
-void
-GraphicContextState::pop(CL_GraphicContext* gc)
-{
-  if (gc == 0)
-    gc = CL_Display::get_current_window()-&gt;get_gc();
-  
-  gc-&gt;pop_modelview();
-}
-#endif
-
-Rectf
-GraphicContextState::get_clip_rect()
-{
-  return Rectf(Vector(-impl-&gt;offset.x,
-                            -impl-&gt;offset.y),
-                  Sizef(get_width()  / impl-&gt;zoom,
-                           get_height() / impl-&gt;zoom));
-}
-
-void
-GraphicContextState::set_pos(const Vector&amp; pos)
-{
-  impl-&gt;offset.x = -pos.x + (get_width()/2  / impl-&gt;zoom);
-  impl-&gt;offset.y = -pos.y + (get_height()/2 / impl-&gt;zoom);
-}
-
-Vector
-GraphicContextState::get_pos() const
-{
-  return Vector(-impl-&gt;offset.x + (get_width()/2  / impl-&gt;zoom),
-                   -impl-&gt;offset.y + (get_height()/2  / impl-&gt;zoom));
-}
-
-void
-GraphicContextState::set_zoom(Vector pos, float z)
-{
-  float old_zoom = impl-&gt;zoom;
-  set_zoom(z);
-  impl-&gt;offset.x = pos.x/impl-&gt;zoom - pos.x/old_zoom + impl-&gt;offset.x;
-  impl-&gt;offset.y = pos.y/impl-&gt;zoom - pos.y/old_zoom + impl-&gt;offset.y;
-}
-
-void
-GraphicContextState::set_zoom(float z)
-{
-  impl-&gt;zoom = z;
-}
-
-float
-GraphicContextState::get_zoom()
-{
-  return impl-&gt;zoom;
-}
-
-void
-GraphicContextState::zoom_to (const Rectf&amp; rect)
-{
-  float center_x = (rect.left + rect.right) / 2.0f;
-  float center_y = (rect.top + rect.bottom) / 2.0f;
-
-  float width  = rect.right - rect.left;
-  float height = rect.bottom - rect.top;
-  float screen_relation = float(get_height())/float(get_width ());
-  float rect_relation   = height/width; 
-  
-  //std::cout &lt;&lt; &quot;Screen: &quot; &lt;&lt; screen_relation &lt;&lt; &quot; Zoom: &quot; &lt;&lt; rect_relation &lt;&lt; std::endl;
-  if (rect_relation &lt; screen_relation) // take width, ignore height
-    {
-      impl-&gt;zoom = get_width()/width; 
-    }
-  else // take height, ignore width
-    {
-      impl-&gt;zoom = get_height()/height;
-    }
-
-  impl-&gt;offset.x = (get_width()  / (2*impl-&gt;zoom)) - center_x;
-  impl-&gt;offset.y = (get_height() / (2*impl-&gt;zoom)) - center_y;
-}
-
-Vector
-GraphicContextState::screen2world(const Point&amp; pos_)
-{
-  Vector pos(pos_.x, pos_.y);
-
-  float sa = sin(-impl-&gt;rotation/180.0f*M_PI);
-  float ca = cos(-impl-&gt;rotation/180.0f*M_PI);
-
-  float dx = pos.x - impl-&gt;width/2;
-  float dy = pos.y - impl-&gt;height/2;
-
-  pos.x = impl-&gt;width/2  + (ca * dx - sa * dy);
-  pos.y = impl-&gt;height/2 + (sa * dx + ca * dy);
-
-  Vector p((float(pos.x) / impl-&gt;zoom) - impl-&gt;offset.x, 
-              (float(pos.y) / impl-&gt;zoom) - impl-&gt;offset.y);
-
-  return p;
-}
-
-void
-GraphicContextState::set_rotation(float angle)
-{
-  impl-&gt;rotation = angle;
-}
-
-float
-GraphicContextState::get_rotation()
-{
-  return impl-&gt;rotation;
-}
-
-int
-GraphicContextState::get_width()  const 
-{
-  return impl-&gt;width; 
-}
-
-int
-GraphicContextState::get_height() const 
-{ 
-  return impl-&gt;height; 
-}
-
-/* EOF */

Deleted: trunk/netbrush/graphic_context_state.hpp
===================================================================
--- trunk/netbrush/graphic_context_state.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/graphic_context_state.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,81 +0,0 @@
-//  $Id$
-// 
-//  Flexlay - A Generic 2D Game Editor
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef HEADER_GRAPHIC_CONTEXT_STATE_HXX
-#define HEADER_GRAPHIC_CONTEXT_STATE_HXX
-
-#include &quot;math/rect.hpp&quot;
-#include &quot;math/point.hpp&quot;
-
-class CL_GraphicContext;
-
-class GraphicContextStateImpl;
-
-/** Helper class for capturing the state of a GraphicContext, with
-    additional convenience functions to make handling GraphicContexts
-    easier */
-class GraphicContextState
-{
-public:
-  GraphicContextState();
-  GraphicContextState(int w, int h);
-
-  void set_size(int w, int h);
-
-  //void push(CL_GraphicContext* gc = 0);
-  //void pop (CL_GraphicContext* gc = 0);
-
-  /** Return a rectangle in world coordinates that represents the area
-      visible on the screen */
-  Rectf get_clip_rect();
-
-  int get_width()  const;
-  int get_height() const;
-
-  /** Set the current rotation angel */
-  void  set_rotation(float angle);
-
-  /** Return the current rotation angel */
-  float get_rotation();
-
-  /** Move the center of the visible area to pos */
-  void   set_pos(const Vector&amp; pos);
-  Vector get_pos() const;
-
-  /** Set zoom to z, while ensuring that the screen position \a pos
-      (normaly the position of the mouse pointer) stays in the same
-      position even after zoomed in/out */
-  void  set_zoom(Vector pos, float z);
-  void  set_zoom(float z);
-  float get_zoom(); 
-
-  void zoom_to (const Rectf&amp; rect);
-
-  Vector screen2world(const Point&amp; pos);
-
-private:
-  GraphicContextStateImpl* impl;
-
-  GraphicContextState (const GraphicContextState&amp;);
-  GraphicContextState&amp; operator= (const GraphicContextState&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/grayscale_buffer.cpp
===================================================================
--- trunk/netbrush/grayscale_buffer.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/grayscale_buffer.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,202 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;assert.h&gt;
-#include &lt;string.h&gt;
-#include &lt;iomanip&gt;
-#include &lt;iostream&gt;
-#include &lt;algorithm&gt;
-#include &quot;math/rect.hpp&quot;
-#include &quot;video.hpp&quot;
-#include &quot;grayscale_buffer.hpp&quot;
-
-GrayscaleBuffer::GrayscaleBuffer(SDL_Surface* surface)
-  : width(surface-&gt;w), height(surface-&gt;h)
-{
-  buffer = new unsigned char[width*height];
-
-  SDL_LockSurface(surface);
-  int bpp = surface-&gt;format-&gt;BytesPerPixel;
-
-  Uint8* data = static_cast&lt;Uint8*&gt;(surface-&gt;pixels);
-  Uint8 r, g, b, a;
-  for(int i = 0; i &lt; width*height; ++i)
-    {
-      //if (i % width == 0)
-      //std::cout &lt;&lt; std::endl;
-
-      SDL_GetRGBA(*reinterpret_cast&lt;Uint32*&gt;(data + (i*bpp)), surface-&gt;format, &amp;r, &amp;g, &amp;b, &amp;a);
-
-      if (0)
-        std::cout &lt;&lt; &quot;(&quot; &lt;&lt; std::setw(3) &lt;&lt; int(r) &lt;&lt; &quot; &quot;
-                &lt;&lt; std::setw(3) &lt;&lt; int(g) &lt;&lt; &quot; &quot;
-                &lt;&lt; std::setw(3) &lt;&lt; int(b) &lt;&lt; &quot; &quot;
-                &lt;&lt; std::setw(3) &lt;&lt; int(a) &lt;&lt; &quot;)  &quot;;
-
-      buffer[i] = (((255 - (r + g + b))/3 * a)/255);
-    }
-  //std::cout &lt;&lt; std::endl;
-  SDL_UnlockSurface(surface);
-}
-
-GrayscaleBuffer::GrayscaleBuffer(int w, int h, Uint8 c)
-  : width(w), height(h)
-{
-  buffer = new unsigned char[w*h];
-  memset(buffer, c, w*h);
-}
-
-GrayscaleBuffer::~GrayscaleBuffer()
-{
-}
-
-void
-GrayscaleBuffer::clear(Uint8 c)
-{
-  memset(buffer, c, width*height);
-}
-  
-void
-GrayscaleBuffer::fill_rect(const Rect&amp; rect_, Uint8 c)
-{
-  Rect rect = rect_;
-  clip_to(rect, Rect(0, 0, width, height));
-
-  // FIXME: Ugly way to clip
-  if (rect.left &lt; rect.right &amp;&amp; rect.top &lt; rect.bottom)
-    for(int y = rect.top; y &lt; rect.bottom; ++y)
-      {
-        memset(buffer + y * width + rect.left, c, rect.get_width());
-      }
-}
-
-void
-GrayscaleBuffer::blit(GrayscaleBuffer* source, SDL_Rect* srcrect, int of_x, int of_y)
-{
-  assert(!&quot;Implement me&quot;);
-}
-
-void
-GrayscaleBuffer::blit(GrayscaleBuffer* source, int of_x, int of_y, BlendMode mode)
-{
-  int start_x = std::max(of_x, 0);
-  int start_y = std::max(of_y, 0);
-
-  int end_x = std::min(of_x + source-&gt;width,  width);
-  int end_y = std::min(of_y + source-&gt;height, height);
-
-  // insert blitter here
-
-  switch(mode)
-    { 
-    case OPAQUE:
-      for(int y = start_y; y &lt; end_y ; ++y)
-        for(int x = start_x; x &lt; end_x ; ++x)
-          {
-            Uint8&amp; f = buffer[y * width + x];
-            Uint8&amp; p = source-&gt;buffer[(y - of_y) * source-&gt;width + (x - of_x)];
-          
-            f = p;
-          }
-      break;
-  
-    case ADDITION:
-      for(int y = start_y; y &lt; end_y ; ++y)
-        for(int x = start_x; x &lt; end_x ; ++x)
-          {
-            Uint8&amp; f = buffer[y * width + x];
-            Uint8&amp; p = source-&gt;buffer[(y - of_y) * source-&gt;width + (x - of_x)];
-          
-            f = std::max(std::min(f + p, 255), 0);
-          }      
-      break;
-
-    case SUBTRACT:
-      for(int y = start_y; y &lt; end_y ; ++y)
-        for(int x = start_x; x &lt; end_x ; ++x)
-          {
-            Uint8&amp; f = buffer[y * width + x];
-            Uint8&amp; p = source-&gt;buffer[(y - of_y) * source-&gt;width + (x - of_x)];
-          
-            f = std::max(f - p, 0);
-          }      
-      break;
-
-    case ALPHA:
-      for(int y = start_y; y &lt; end_y ; ++y)
-        for(int x = start_x; x &lt; end_x ; ++x)
-          {
-            Uint8&amp; f = buffer[y * width + x];
-            Uint8&amp; p = source-&gt;buffer[(y - of_y) * source-&gt;width + (x - of_x)];
-            
-            // Works, but not exactly alpha
-            f = std::max(std::min(f + p/4, 255), 0);
-            
-            //f = (((255 - p) * f) + (p * p))/255; 
-            
-            // Speed worm: f = ((p)*p + p*f)/255;
-          }      
-      break;
-      
-    default:
-      assert(!&quot;Unknown blend mode&quot;);
-    }
-}
-
-#ifdef __TEST__
-#include &lt;stdio.h&gt;
-
-void print(GrayscaleBuffer&amp; buffer)
-{
-  for(int y = 0; y &lt; buffer.get_height(); ++y)
-    {
-      for(int x = 0; x &lt; buffer.get_width(); ++x)
-      {
-        printf(&quot;%3d &quot;, int(buffer.at(x,y)));
-      }
-      putchar('\n');
-    }
-  putchar('\n');
-}
-
-int main()
-{
-  GrayscaleBuffer target(20,20, 0);
-  GrayscaleBuffer source(5,5, 99);
-
-  print(target);
-  print(source);
-  
-  target.blit(&amp;source, -3, -3, GrayscaleBuffer::ADDITION);
-  target.blit(&amp;source, 5, 4, GrayscaleBuffer::ADDITION);
-  target.blit(&amp;source, 7, 5, GrayscaleBuffer::SUBTRACT);
-
-  print(target);
- 
-}
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/grayscale_buffer.hpp
===================================================================
--- trunk/netbrush/grayscale_buffer.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/grayscale_buffer.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,68 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_GRAYSCALE_BUFFER_HPP
-#define HEADER_GRAYSCALE_BUFFER_HPP
-
-#include &lt;assert.h&gt;
-#include &quot;SDL.h&quot;
-
-class Rect;
-
-class GrayscaleBuffer
-{
-private:
-  int    width;
-  int    height;
-  Uint8* buffer;
-
-public:
-  enum BlendMode { OPAQUE, ALPHA, ADDITION, SUBTRACT };
-
-  GrayscaleBuffer(SDL_Surface* surface);
-  GrayscaleBuffer(int w, int h, Uint8 c);
-  ~GrayscaleBuffer();
-  
-  void blit(GrayscaleBuffer* source, SDL_Rect* srcrect, int of_x, int of_y);
-  void blit(GrayscaleBuffer* source, int of_x, int of_y, BlendMode mode);
-
-  inline Uint8&amp; at(int x, int y) 
-  { 
-    assert(x &gt;= 0 &amp;&amp; x &lt; width &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; height);
-    return buffer[y * width + x];
-  }
-
-  void clear(Uint8 c);
-  void fill_rect(const Rect&amp; rect, Uint8 c);
-
-  Uint8* get_data() { return buffer; }
-
-  int get_width()  const { return width; }
-  int get_height() const { return height; }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/hue_picker.cpp
===================================================================
--- trunk/netbrush/hue_picker.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/hue_picker.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,130 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;vector&gt;
-#include &quot;video.hpp&quot;
-#include &quot;color.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;widget/widget_manager.hpp&quot;
-#include &quot;saturation_value_picker.hpp&quot;
-#include &quot;globals.hpp&quot;
-
-#include &quot;hue_picker.hpp&quot;
-
-HuePicker::HuePicker(const Rect&amp; rect_)
-  : Widget(rect_), dragging(0)
-{
-  surface = create_surface(rect_.get_width(), rect_.get_height());
-  
-  SDL_LockSurface(surface);
-  Uint8* data = static_cast&lt;Uint8*&gt;(surface-&gt;pixels);
-
-  for(int y = 0; y &lt; surface-&gt;h; ++y)
-    for(int x = 0; x &lt; surface-&gt;w; ++x)
-      {
-        int hue = 255 * x / surface-&gt;w;
-        const Color&amp; color = get_color(hue);
-        data[3*(y * surface-&gt;w + x)+0] = color.r;
-        data[3*(y * surface-&gt;w + x)+1] = color.g;
-        data[3*(y * surface-&gt;w + x)+2] = color.b;
-      }
-  SDL_UnlockSurface(surface);  
-}
-
-Color
-HuePicker::get_color(Uint8 hue)
-{
-  static Color colors[] = { Color(255,   0,   0),
-                            Color(255,   0, 255),
-                            Color(  0,   0, 255),
-                            Color(  0, 255, 255),
-                            Color(  0, 255,   0),
-                            Color(255, 255,   0),
-                            Color(255,   0,   0) };
-  
-  int seg_len = (255/6);
-  int seg  = (hue / seg_len);
-  int prog = (hue % seg_len);
-
-  return Color((((seg_len - prog) * colors[seg].r) + (prog * colors[seg+1].r))/seg_len,
-               (((seg_len - prog) * colors[seg].g) + (prog * colors[seg+1].g))/seg_len,
-               (((seg_len - prog) * colors[seg].b) + (prog * colors[seg+1].b))/seg_len);
-}
-
-void
-HuePicker::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  if (dragging)
-    {
-      click_pos.x = motion.x;
-      click_pos.y = motion.y;
-      saturation_value_picker-&gt;set_color(get_color(255 * click_pos.x / get_rect().get_width()));
-      set_dirty(true);
-    }
-}
-
-void
-HuePicker::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (button.button == 1)
-    {
-      if (button.state == SDL_RELEASED)
-        {
-          dragging = false;
-          widget_manager-&gt;ungrab(this);
-        }
-      else if (button.state == SDL_PRESSED)
-        {
-          dragging = true;
-
-          click_pos.x = button.x;
-          click_pos.y = button.y;
-
-          saturation_value_picker-&gt;set_color(get_color(255 * click_pos.x / get_rect().get_width()));
-
-          set_dirty(true);
-          widget_manager-&gt;grab(this);
-        }
-    }
-}
-
-void
-HuePicker::draw(SDL_Surface* target)
-{
-  SDL_Rect pos;
-  pos.x = get_rect().left;
-  pos.y = get_rect().top;
-
-  SDL_Rect vline;
-  vline.x = click_pos.x + get_rect().left;
-  vline.y = 0 + get_rect().top;
-  vline.w = 1;
-  vline.h = get_rect().get_height();
-
-  SDL_BlitSurface(surface, 0, target, &amp;pos);
-  SDL_FillRect(target, &amp;vline, SDL_MapRGB(target-&gt;format, 0, 0, 0));
-}
-
-/* EOF */

Deleted: trunk/netbrush/hue_picker.hpp
===================================================================
--- trunk/netbrush/hue_picker.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/hue_picker.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,61 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_HUE_PICKER_HPP
-#define HEADER_HUE_PICKER_HPP
-
-#include &quot;widget/widget.hpp&quot;
-
-/** */
-class HuePicker : public Widget
-{
-private:
-  SDL_Surface* surface;
-  bool  dragging;
-  Point click_pos;
-
-public:
-  HuePicker(const Rect&amp; rect);
-
-  Color get_color(Uint8 hue);
-
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-
-  void set_hue(Uint8 hue);
-
-  void on_enter() {}
-  void on_leave() {}
-
-  void draw(SDL_Surface* target);
- 
-private:
-  HuePicker (const HuePicker&amp;);
-  HuePicker&amp; operator= (const HuePicker&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/navigation.cpp
===================================================================
--- trunk/netbrush/navigation.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/navigation.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,105 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;video.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;drawing_context.hpp&quot;
-#include &quot;screen_buffer.hpp&quot;
-#include &quot;navigation.hpp&quot;
-
-Navigation::Navigation(const Rect&amp; rect_)
-  : Widget(rect_), dragging(false)
-{
-  surface = create_surface(rect_.get_width(), rect_.get_height());  
-}
-
-void
-Navigation::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  if (dragging)
-    {
-      screen_buffer-&gt;move_to(draw_ctx-&gt;get_width()  * motion.x / get_rect().get_width(),
-                             draw_ctx-&gt;get_height() * motion.y / get_rect().get_height());
-    }
-}
-
-void
-Navigation::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (button.button == 1)
-    {
-      if (button.state == SDL_RELEASED)
-        {
-          screen_buffer-&gt;move_to(draw_ctx-&gt;get_width()  * button.x / get_rect().get_width(),
-                                 draw_ctx-&gt;get_height() * button.y / get_rect().get_height());
-          dragging = false;
-        }
-      else if (button.state == SDL_PRESSED)
-        {
-          screen_buffer-&gt;move_to(draw_ctx-&gt;get_width()  * button.x / get_rect().get_width(),
-                                 draw_ctx-&gt;get_height() * button.y / get_rect().get_height());
-          dragging = true;
-        }
-    }
-}
-
-void
-Navigation::draw(SDL_Surface* target)
-{
-  SDL_Rect pos;
-  pos.x = get_rect().left;
-  pos.y = get_rect().top;
-
-  SDL_BlitSurface(surface, 0, target, &amp;pos);  
-}
-
-void
-Navigation::update()
-{
-  //std::cout &lt;&lt; &quot;Navigation::update&quot; &lt;&lt; std::endl;
-  SDL_Surface* drawable = draw_ctx-&gt;get_surface();
-  SDL_LockSurface(drawable);
-  SDL_LockSurface(surface);
-
-  Uint8* target = static_cast&lt;Uint8*&gt;(surface-&gt;pixels);
-  Uint8* source = static_cast&lt;Uint8*&gt;(drawable-&gt;pixels);
-
-  int sx = drawable-&gt;w / surface-&gt;w;
-  int sy = drawable-&gt;h / surface-&gt;h;
-  
-  for(int y = 0; y &lt; surface-&gt;h; ++y)
-    for(int x = 0; x &lt; surface-&gt;pitch; ++x)
-      {
-        target[y * surface-&gt;pitch + x] = source[(y*sy) * drawable-&gt;pitch + (x*sx)];
-      }
-
-  SDL_UnlockSurface(surface);
-  SDL_UnlockSurface(drawable);
-
-  set_dirty(true);
-}
-
-/* EOF */

Deleted: trunk/netbrush/navigation.hpp
===================================================================
--- trunk/netbrush/navigation.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/navigation.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,55 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_NAVIGATION_HPP
-#define HEADER_NAVIGATION_HPP
-
-#include &quot;widget/widget.hpp&quot;
-
-/** */
-class Navigation : public Widget
-{
-private:
-  SDL_Surface* surface;
-  bool dragging;
-public:
-  Navigation(const Rect&amp; rect);
-  
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-
-  void on_enter() {};
-  void on_leave() {}
-
-  void draw(SDL_Surface* target);
-  void update();
-private:
-  Navigation (const Navigation&amp;);
-  Navigation&amp; operator= (const Navigation&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/saturation_value_picker.cpp
===================================================================
--- trunk/netbrush/saturation_value_picker.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/saturation_value_picker.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,140 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;video.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;widget/widget_manager.hpp&quot;
-#include &quot;color.hpp&quot;
-#include &quot;alpha_picker.hpp&quot;
-#include &quot;saturation_value_picker.hpp&quot;
-
-SaturationValuePicker::SaturationValuePicker(const Rect&amp; rect_)
-  : Widget(rect_), dragging(false), click_pos(64, 64)
-{
-  surface = create_surface(rect_.get_width(), rect_.get_height());
-  set_color(Color(255, 0, 0));
-
-  alpha_picker-&gt;set_color(get_color(255 * click_pos.x/get_rect().get_width(),
-                                    255 * click_pos.y/get_rect().get_height()));
-}
-
-void
-SaturationValuePicker::set_color(const Color&amp; color_)
-{
-  color = color_;
-  SDL_LockSurface(surface);
-
-  Uint8* data = static_cast&lt;Uint8*&gt;(surface-&gt;pixels);
-  
-  for(int y = 0; y &lt; surface-&gt;h; ++y)
-    for(int x = 0; x &lt; surface-&gt;w; ++x)
-      {
-        int value      = 255 - (255 * x / surface-&gt;w);
-        int saturation = (255 * y / surface-&gt;h);
-        
-        data[3*(y * surface-&gt;w + x)+0] = (0*value + (255-value) * ((255 * saturation + color.r * (255 - saturation))/255))/255;
-        data[3*(y * surface-&gt;w + x)+1] = (0*value + (255-value) * ((255 * saturation + color.g * (255 - saturation))/255))/255;
-        data[3*(y * surface-&gt;w + x)+2] = (0*value + (255-value) * ((255 * saturation + color.b * (255 - saturation))/255))/255;
-      }
-  SDL_UnlockSurface(surface);
-  
-  alpha_picker-&gt;set_color(get_color(255 - 255 * click_pos.x/get_rect().get_width(),
-                                    255 * click_pos.y/get_rect().get_height()));
-  set_dirty(true);
-}
-
-Color
-SaturationValuePicker::get_color(Uint8 value, Uint8 saturation) const
-{
-  return Color((0*value + (255-value) * ((255 * saturation + color.r * (255 - saturation))/255))/255,
-               (0*value + (255-value) * ((255 * saturation + color.g * (255 - saturation))/255))/255,
-               (0*value + (255-value) * ((255 * saturation + color.b * (255 - saturation))/255))/255);  
-}
-
-void
-SaturationValuePicker::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  set_dirty(true);
-  if (dragging)
-    {
-      click_pos.x = std::min(std::max(0, motion.x), get_rect().get_width());
-      click_pos.y = std::min(std::max(0, motion.y), get_rect().get_height());
-      alpha_picker-&gt;set_color(get_color(255 - 255 * click_pos.x/get_rect().get_width(),
-                                        255 * click_pos.y/get_rect().get_height()));
-    }
-}
-
-void
-SaturationValuePicker::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (button.button == 1)
-    {
-      if (button.state == SDL_RELEASED)
-        {
-          dragging = false;
-          widget_manager-&gt;ungrab(this);
-        }
-      else if (button.state == SDL_PRESSED)
-        {
-          dragging = true;
-
-          click_pos.x = std::min(std::max(0, button.x), get_rect().get_width());
-          click_pos.y = std::min(std::max(0, button.y), get_rect().get_height());
-      
-          set_dirty(true);
-          widget_manager-&gt;grab(this);
-          alpha_picker-&gt;set_color(get_color(255 - 255 * click_pos.x/get_rect().get_width(),
-                                            255 * click_pos.y/get_rect().get_height()));
-        }
-    }
-}
-
-void
-SaturationValuePicker::draw(SDL_Surface* target)
-{
-  SDL_Rect pos;
-  pos.x = get_rect().left;
-  pos.y = get_rect().top;
-
-  SDL_Rect hline;
-  hline.x = 0  + get_rect().left;;
-  hline.y = click_pos.y  + get_rect().top;
-  hline.w = get_rect().get_width();
-  hline.h = 1;
-
-  SDL_Rect vline;
-  vline.x = click_pos.x + get_rect().left;
-  vline.y = 0 + get_rect().top;
-  vline.w = 1;
-  vline.h = get_rect().get_height();
-
-  SDL_BlitSurface(surface, 0, target, &amp;pos);
-
-  SDL_FillRect(target, &amp;hline, SDL_MapRGB(target-&gt;format, 0, 0, 0));
-  SDL_FillRect(target, &amp;vline, SDL_MapRGB(target-&gt;format, 0, 0, 0));
-}
-
-/* EOF */

Deleted: trunk/netbrush/saturation_value_picker.hpp
===================================================================
--- trunk/netbrush/saturation_value_picker.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/saturation_value_picker.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,60 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_SATURATION_VALUE_PICKER_HPP
-#define HEADER_SATURATION_VALUE_PICKER_HPP
-
-#include &quot;widget/widget.hpp&quot;
-
-/** */
-class SaturationValuePicker : public Widget
-{
-private:
-  Color color;
-  SDL_Surface* surface;
-  bool  dragging;
-  Point click_pos;
-public:
-  SaturationValuePicker(const Rect&amp; rect);
-
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-
-  void on_enter() {};
-  void on_leave() {}
-
-  void draw(SDL_Surface* target);
-  void set_color(const Color&amp; color);
-
-  Color get_color(Uint8 value, Uint8 saturation) const;
-
-private:
-  SaturationValuePicker (const SaturationValuePicker&amp;);
-  SaturationValuePicker&amp; operator= (const SaturationValuePicker&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/screen_buffer.cpp
===================================================================
--- trunk/netbrush/screen_buffer.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/screen_buffer.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,329 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &lt;sstream&gt;
-#include &quot;video.hpp&quot;
-#include &quot;drawing_context.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;stroke_buffer.hpp&quot;
-#include &quot;widget/widget_manager.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;server_connection.hpp&quot;
-#include &quot;widget/scrollbar.hpp&quot;
-#include &quot;screen_buffer.hpp&quot;
-
-ScreenBuffer::ScreenBuffer(const Rect&amp; rect)
-  : Widget(rect),
-    scroll_offset_x(0),
-    scroll_offset_y(0),
-    old_scroll_offset_x(0),
-    old_scroll_offset_y(0),
-    click_pos_x(0),
-    click_pos_y(0),
-    scrolling(false),
-    complete_refresh(false)
-{
-}
-
-ScreenBuffer::~ScreenBuffer()
-{
-  //  SDL_FreeSurface(buffer);
-}
-
-void
-ScreenBuffer::draw(SDL_Surface* target)
-{
-  //SDL_SetClipRect(target, &amp;rect);
-
-  int trans_x = get_rect().left + scroll_offset_x;
-  int trans_y = get_rect().top  + scroll_offset_y;
-
-  // Transform dirty_region into screen space
-  dirty_region.left   += trans_x;
-  dirty_region.top    += trans_y;
-  dirty_region.right  += trans_x;
-  dirty_region.bottom += trans_y;
-  
-  if (1)
-    {
-      dirty_region.left   = std::max(get_rect().left,   dirty_region.left);
-      dirty_region.top    = std::max(get_rect().top,    dirty_region.top);
-      dirty_region.right  = std::min(get_rect().right,  dirty_region.right);
-      dirty_region.bottom = std::min(get_rect().bottom, dirty_region.bottom);
-    }
-
-  if (0)
-    std::cout &lt;&lt; &quot;Updating screen: &quot;
-              &lt;&lt; dirty_region.left  &lt;&lt; &quot; &quot;
-              &lt;&lt; dirty_region.top   &lt;&lt; &quot; &quot;
-              &lt;&lt; dirty_region.right &lt;&lt; &quot; &quot;
-              &lt;&lt; dirty_region.bottom 
-              &lt;&lt; std::endl;
-
-  // FIXME: Should go elsewhere
-  horizontal_scrollbar-&gt;set_pos(-scroll_offset_x);
-  vertical_scrollbar-&gt;set_pos(-scroll_offset_y);
-
-  if (complete_refresh)
-    { 
-      SDL_Rect r;
-      r.x = get_rect().left;
-      r.y = get_rect().top;
-      r.w = get_rect().get_width();
-      r.h = get_rect().get_height();
-      SDL_FillRect(target, &amp;r, SDL_MapRGB(target-&gt;format, 0, 0, 0));
-    }
-
-  // check for invalid dirty_regions (ie. canvas is completly outside of the view)
-  if (dirty_region.left &lt; dirty_region.right &amp;&amp;
-      dirty_region.top  &lt;  dirty_region.bottom)
-    {
-      draw_ctx-&gt;draw(target, dirty_region, trans_x, trans_y);
-      if (!scrolling)
-        stroke_buffer-&gt;draw(target, dirty_region, trans_x, trans_y);
-
-      { // draw layer boundary
-        Uint32 color = SDL_MapRGB(target-&gt;format, 0, 0, 0);
-        SDL_Rect r;
-
-        r.x = trans_x;
-        r.y = trans_y;
-        r.w = draw_ctx-&gt;get_width();
-        r.h = 1;
-
-        SDL_FillRect(target, &amp;r, color);
-
-        r.x = trans_x;
-        r.y = draw_ctx-&gt;get_height()-1 + trans_y;
-        r.w = draw_ctx-&gt;get_width();
-        r.h = 1;
-
-        SDL_FillRect(target, &amp;r, color);
-
-        r.x = draw_ctx-&gt;get_width()-1 + trans_x;
-        r.y = trans_y;
-        r.w = 1;
-        r.h = draw_ctx-&gt;get_height();
-
-        SDL_FillRect(target, &amp;r, color);
-
-        r.x = trans_x;
-        r.y = trans_y;
-        r.w = 1;
-        r.h = draw_ctx-&gt;get_height();
-
-        SDL_FillRect(target, &amp;r, color);
-      }
-  
-      if (complete_refresh)
-        { 
-          SDL_Rect r;
-          r.x = get_rect().left;
-          r.y = get_rect().top;
-          r.w = get_rect().get_width();
-          r.h = get_rect().get_height();
-            
-          SDL_UpdateRect(target, r.x, r.y, r.w, r.h);
-        }
-      else
-        {
-          SDL_UpdateRect(target, 
-                         dirty_region.left,        dirty_region.top, 
-                         dirty_region.get_width(), dirty_region.get_height());
-        }
-    }
-  else 
-    {
-      if (complete_refresh)
-        { 
-          SDL_Rect r;
-          r.x = get_rect().left;
-          r.y = get_rect().top;
-          r.w = get_rect().get_width();
-          r.h = get_rect().get_height();
-            
-          SDL_UpdateRect(target, r.x, r.y, r.w, r.h);
-        }
-    }
-
-  if (0) 
-    std::cout &lt;&lt; &quot;Updating done&quot; &lt;&lt; std::endl;
-
-  complete_refresh = false;
-}
-
-void
-ScreenBuffer::mark_dirty(const Rect&amp; region)
-{
-  mark_dirty(region.left, region.top, region.get_width(), region.get_height());
-}
-
-void
-ScreenBuffer::mark_dirty(int x, int y, int w, int h)
-{
-  if (x &lt; 0)
-    x = 0;
-
-  if (y &lt; 0)
-    y = 0;
-  
-  // FIXME: This must be drawable size, not screen size
-  if (x + w &gt; draw_ctx-&gt;get_width())
-    w = draw_ctx-&gt;get_width() - x;
-
-  if (y + h &gt; draw_ctx-&gt;get_height())
-    h = draw_ctx-&gt;get_height() - y;
-
-  //std::cout &lt;&lt; &quot;Dirty: &quot; &lt;&lt; x &lt;&lt; &quot; &quot; &lt;&lt; y &lt;&lt; &quot; &quot; &lt;&lt; w &lt;&lt; &quot; &quot; &lt;&lt; h &lt;&lt; std::endl;
-
-  if (is_dirty())
-    {
-      int x1 = dirty_region.left;
-      int y1 = dirty_region.top;
-      int x2 = dirty_region.right;
-      int y2 = dirty_region.bottom;
-
-      dirty_region.left = std::min(x, x1);
-      dirty_region.top  = std::min(y, y1);
-      
-      dirty_region.right  = std::max(x+w, x2);
-      dirty_region.bottom = std::max(y+h, y2);
-    }
-  else
-    {
-      dirty_region.left   = x;
-      dirty_region.top    = y;
-      dirty_region.right  = x + w;
-      dirty_region.bottom = y + h;
-      set_dirty(true);
-    }
-}
-
-void
-ScreenBuffer::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  //satd::cout &lt;&lt; motion.x &lt;&lt; &quot; &quot; &lt;&lt; motion.y &lt;&lt; std::endl;
-  if (current_stroke)
-    {
-      current_stroke-&gt;add_dab(Dab(motion.x - scroll_offset_x, motion.y - scroll_offset_y));
-      stroke_buffer-&gt;add_dab(Dab(motion.x - scroll_offset_x, motion.y - scroll_offset_y));
-
-      // sync
-      Rect rect = current_stroke-&gt;get_bounding_rect(); 
-              
-      // calculate bounding rectangle by taking brush thickness into account
-      rect.left -= client_draw_param-&gt;thickness()/2;
-      rect.top  -= client_draw_param-&gt;thickness()/2;
-
-      rect.right  += client_draw_param-&gt;thickness()/2;
-      rect.bottom += client_draw_param-&gt;thickness()/2;
-                  
-      mark_dirty(rect);
-    }
-
-  if (scrolling)
-    {
-      scroll_offset_x = old_scroll_offset_x + (motion.x - click_pos_x);
-      scroll_offset_y = old_scroll_offset_y + (motion.y - click_pos_y);
-
-      Rect r(0, 0, get_rect().get_width(), get_rect().get_height());
-      r.left   -= scroll_offset_x;
-      r.right  -= scroll_offset_x;
-      r.top    -= scroll_offset_y;
-      r.bottom -= scroll_offset_y;
-      mark_dirty(r);
-      complete_refresh = true;
-      //std::cout &lt;&lt; &quot;Scrolling: &quot; &lt;&lt; scroll_offset_x &lt;&lt; &quot; &quot; &lt;&lt; scroll_offset_y &lt;&lt; std::endl;
-    } 
-}
-
-void
-ScreenBuffer::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (button.state == SDL_RELEASED)
-    {
-      if (button.button == 1)
-        {
-          if (current_stroke)
-            {
-              widget_manager-&gt;ungrab(this);
-
-              stroke_buffer-&gt;clear();
-              server-&gt;send_stroke(*current_stroke, client_draw_param);
-
-              current_stroke = 0;
-            }
-        }
-      else if (button.button == 2)
-        {
-          scroll_offset_x = old_scroll_offset_x + (button.x - click_pos_x);
-          scroll_offset_y = old_scroll_offset_y + (button.y - click_pos_y);
-          scrolling = false;
-        }
-    }  
-  else if (button.state == SDL_PRESSED)
-    {
-      if (button.button == 1)
-        {
-          widget_manager-&gt;grab(this);
-          current_stroke = new Stroke();
-
-          current_stroke-&gt;add_dab(Dab(button.x - scroll_offset_x, button.y - scroll_offset_y));
-          stroke_buffer-&gt;add_dab(Dab(button.x - scroll_offset_x, button.y - scroll_offset_y));
-
-          // FIXME: First dab is lost
-        }
-      else if (button.button == 2)
-        {
-          click_pos_x = button.x;
-          click_pos_y = button.y;
-
-          old_scroll_offset_x = scroll_offset_x;
-          old_scroll_offset_y = scroll_offset_y;
-
-          scrolling = true;
-        }
-    }
-}
-
-void
-ScreenBuffer::move_to(int x, int y)
-{
-  scroll_offset_x = get_rect().get_width()/2  - x;
-  scroll_offset_y = get_rect().get_height()/2 - y;
-  //std::cout &lt;&lt; &quot;MoveTo: &quot; &lt;&lt; x &lt;&lt; &quot; &quot; &lt;&lt; y &lt;&lt; std::endl;
-
-  Rect r(0, 0, get_rect().get_width(), get_rect().get_height());
-  r.left   -= scroll_offset_x;
-  r.right  -= scroll_offset_x;
-  r.top    -= scroll_offset_y;
-  r.bottom -= scroll_offset_y;
-  mark_dirty(r);
-  complete_refresh = true;
-  set_dirty(true);
-}
-
-/* EOF */

Deleted: trunk/netbrush/screen_buffer.hpp
===================================================================
--- trunk/netbrush/screen_buffer.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/screen_buffer.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,77 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_SCREEN_BUFFER_HPP
-#define HEADER_SCREEN_BUFFER_HPP
-
-#include &quot;SDL.h&quot;
-#include &quot;widget/widget.hpp&quot;
-
-/** */
-class ScreenBuffer : public Widget
-{
-private:
-  //SDL_Surface* buffer;
-  Rect dirty_region;
-
-  int scroll_offset_x;
-  int scroll_offset_y;
-
-  int old_scroll_offset_x;
-  int old_scroll_offset_y;
-
-  int click_pos_x;
-  int click_pos_y;
-
-  bool scrolling;
-  bool complete_refresh;
-public:
-  ScreenBuffer(const Rect&amp; rect);
-  ~ScreenBuffer();
-
-  // Mark an region as dirty in canvas space, not screen space
-  void mark_dirty(int x, int y, int w, int h);
-  void mark_dirty(const Rect&amp; region);
-  
-  void draw(SDL_Surface* target);
-
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-  
-  void on_enter() {}
-  void on_leave() {}
-
-  bool do_update() { return false; }
-
-  void move_to(int x, int y);
-
-private:
-  ScreenBuffer (const ScreenBuffer&amp;);
-  ScreenBuffer&amp; operator= (const ScreenBuffer&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/server.cpp
===================================================================
--- trunk/netbrush/server.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/server.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,369 +0,0 @@
-#include &lt;string&gt;
-#include &lt;iostream&gt;
-#include &lt;fstream&gt;
-#include &lt;sstream&gt;
-#include &lt;vector&gt;
-#include &quot;SDL.h&quot;
-#include &quot;SDL_net.h&quot;
-
-#ifdef WIN32
-#include  &lt;io.h&gt;
-#define access _access
-#define F_OK   0
-#endif
-
-class ClientConnection;
-
-std::vector&lt;ClientConnection*&gt; clients;
-SDLNet_SocketSet socketset;
-
-TCPsocket serversock;
-
-std::vector&lt;std::string&gt; drawing_history;
-
-std::ofstream* outfile = 0;
-
-std::vector&lt;std::string&gt;
-tokenize(const std::string&amp; str, char split_char)
-{
-  std::string::size_type start = 0;
-  std::string::size_type end   = 0;
-
-  std::vector&lt;std::string&gt; tokens;
-
-  while (start &lt; str.size())
-    {
-      if ((end = str.find(split_char, start)) == std::string::npos)
-        {
-          tokens.push_back(str.substr(start));
-          break;
-        }
-
-      const std::string&amp; ret = str.substr(start, end - start);
-
-      if (!ret.empty())
-        tokens.push_back(ret);
-
-      start = end + 1;
-    }
-
-  return tokens;
-}
-
-class ClientConnection
-{
-public:
-  int id;
-  TCPsocket   tcpsock;
-  int         buffer_pos;
-  std::string buffer;
-  bool        invalid;
-  bool        full_client;
-public:
-  ClientConnection(int id_, TCPsocket socket)
-    : id(id_), 
-      tcpsock(socket),
-      invalid(false)
-  {
-    buffer_pos = 0;
-    full_client = false;
-  }
-  
-  bool is_invalid()
-  {
-    return invalid;
-  }
-
-  void update()
-  {
-    if (invalid) return;
-
-    if (SDLNet_SocketReady(tcpsock))
-      {
-        const int MAXLEN = 1024;
-        char msg[MAXLEN];
-
-        int result = SDLNet_TCP_Recv(tcpsock, msg, MAXLEN);
-        if(result &lt;= 0) 
-          {
-            // TCP Connection is broken. (because of error or closure)
-            std::cout &lt;&lt; &quot;# Connection break, abort&quot; &lt;&lt; std::endl;
-            invalid = true;
-            return;
-          }
-        else 
-          {
-            for(int i = 0; i &lt; result; ++i)
-              {
-                if (msg[i] == '\n')
-                  {
-                    process_line(buffer);
-                    buffer.clear();
-                    buffer_pos = 0;
-                  }
-                else
-                  {
-                    buffer += msg[i];
-                  }
-              }
-          }
-      }
-  }
-
-  void send_string(const std::string&amp; line)
-  {
-    if (full_client)
-      {
-        if (invalid) return;
-
-        int result = SDLNet_TCP_Send(tcpsock, const_cast&lt;char*&gt;(line.c_str()), line.length());
-        if (result &lt; int(line.length()))
-          {
-            // It may be good to disconnect sock because it is likely invalid now.
-            printf( &quot;Error: SDLNet_TCP_Send: '%s'\n&quot;, SDLNet_GetError() );
-            invalid = true;
-          }
-      }
-  }
-
-  void process_line(const std::string&amp; line)
-  {
-    if (invalid) return;
-    
-    std::vector&lt;std::string&gt; tokens = tokenize(line, ' ');
-    if (tokens.size() == 2 &amp;&amp; tokens[0] == &quot;load&quot;)
-      {
-        for(int i = 0; i &lt; int(clients.size()); ++i)
-          {
-            if (clients[i])
-              {
-                clients[i]-&gt;send_string(&quot;clear\n&quot;);
-              }
-          }
-        std::cout &lt;&lt; &quot;# load unimplemented&quot; &lt;&lt; std::endl;
-      }
-    else if (tokens.size() == 2 &amp;&amp; tokens[0] == &quot;import&quot;)
-      {
-        std::cout &lt;&lt; &quot;# import unimplemented&quot; &lt;&lt; std::endl;
-      }
-    else if (tokens.size() == 2 &amp;&amp; tokens[0] == &quot;save&quot;)
-      {
-        for(int i = 0; i &lt; int(tokens[1].size()); ++i)
-          {
-            if (tokens[1][i] == '/' || tokens[1][i] == '.')
-              {
-                tokens[1][i] = '.';
-              }
-          }
-        
-        std::ostringstream filename;
-        filename &lt;&lt; &quot;images/&quot; &lt;&lt; tokens[1] &lt;&lt; &quot;.nbr&quot;;        
-
-        int j = 1;
-        std::string fname = filename.str();
-        while (access(fname.c_str(), F_OK) == 0)
-          {
-            filename.str(&quot;&quot;);
-            filename &lt;&lt; &quot;images/&quot; &lt;&lt; tokens[1] &lt;&lt; &quot;-&quot; &lt;&lt; j &lt;&lt; &quot;.nbr&quot;;
-            fname = filename.str();
-            j += 1;
-          }
-
-        std::cout &lt;&lt; &quot;# writing log to &quot; &lt;&lt; filename.str() &lt;&lt; std::endl;
-        std::ofstream out(fname.c_str());
-        for(int i = 0; i &lt; int(drawing_history.size()); ++i)
-          out &lt;&lt; drawing_history[i];
-        out.close();
-      }
-    else if (tokens.size() == 2 &amp;&amp; tokens[0] == &quot;client_version&quot;)
-      {
-        if (atoi(tokens[1].c_str()) == 1)
-          {
-            full_client = true;
-            for(int i = 0; i &lt; int(drawing_history.size()); ++i)
-              {
-                clients.back()-&gt;send_string(drawing_history[i]);
-              }
-          }
-      }
-    else if (tokens.size() == 1 &amp;&amp; tokens[0] == &quot;clear&quot;)
-      {
-        std::ostringstream filename;
-        filename &lt;&lt; &quot;sessions/session-&quot; &lt;&lt; time(NULL) &lt;&lt; &quot;.nbr&quot;;
-        
-        std::cout &lt;&lt; &quot;# writing log to &quot; &lt;&lt; filename.str() &lt;&lt; std::endl;
-        outfile-&gt;close();
-        delete outfile;
-        outfile = new std::ofstream(filename.str().c_str());
-
-        drawing_history.clear();
-
-        for(int i = 0; i &lt; int(clients.size()); ++i)
-          {
-            if (clients[i])
-              {
-                clients[i]-&gt;send_string(&quot;clear\n&quot;);
-              }
-          }
-      }
-    else if (tokens.size() &gt;= 1 &amp;&amp; 
-             (tokens[0] == &quot;dab&quot; ||
-              tokens[0] == &quot;stroke_begin&quot; ||
-              tokens[0] == &quot;stroke_end&quot;   ||
-              tokens[0] == &quot;set_brush&quot;    ||
-              tokens[0] == &quot;set_generic_brush&quot; ||
-              tokens[0] == &quot;set_color&quot;    ||
-              tokens[0] == &quot;set_tool&quot;     ||
-              tokens[0] == &quot;set_opacity&quot; 
-              ))
-      {
-        std::ostringstream str;
-        str &lt;&lt; &quot;client &quot; &lt;&lt; id &lt;&lt; &quot; &quot; &lt;&lt; line &lt;&lt; std::endl;
-        //std::cout &lt;&lt; &quot;SERVER: &quot; &lt;&lt; str.str();
-        drawing_history.push_back(str.str());
-        (*outfile) &lt;&lt; str.str() &lt;&lt; std::flush;
-
-        for(int i = 0; i &lt; int(clients.size()); ++i)
-          {
-            if (clients[i])
-              {
-                clients[i]-&gt;send_string(str.str());
-                // FIXME: write to file
-              }
-          }
-      }
-    else
-      {
-        std::cout &lt;&lt; &quot;# invalid command: &quot; &lt;&lt; line &lt;&lt; std::endl;
-      }
-  }
-};
-
-void accept_connections()
-{
-  if (SDLNet_SocketReady(serversock))
-    {
-      TCPsocket client = SDLNet_TCP_Accept(serversock);
-      if (client)
-        {
-          clients.push_back(new ClientConnection(clients.size()+1, client));
-
-          std::stringstream out;
-          out &lt;&lt; &quot;version 0&quot; &lt;&lt; std::endl;
-          out &lt;&lt; &quot;your_id &quot; &lt;&lt; clients.size() &lt;&lt; std::endl;
-          std::string str = out.str();
-          SDLNet_TCP_Send(client, const_cast&lt;char*&gt;(str.c_str()), str.length()+1);
-
-          IPaddress* ip = SDLNet_TCP_GetPeerAddress(client);
-
-          const char* host;
-          if((host = SDLNet_ResolveIP(ip)) != 0)
-            std::cout &lt;&lt; &quot;# Got client connection from &quot; &lt;&lt; host &lt;&lt; &quot; &quot; &lt;&lt; ip-&gt;port &lt;&lt; std::endl;
-          else
-            std::cout &lt;&lt; &quot;# Got client connection from &quot; &lt;&lt; ip-&gt;host &lt;&lt; &quot; &quot; &lt;&lt; ip-&gt;port &lt;&lt; std::endl;
-          
-          int numused = SDLNet_TCP_AddSocket(socketset, client);
-          if (numused == -1) {
-            printf(&quot;SDLNet_AddSocket: %s\n&quot;, SDLNet_GetError());
-            // perhaps you need to restart the set and make it bigger...
-          } 
-          else
-            {
-              std::cout &lt;&lt; &quot;# Sockets used: &quot; &lt;&lt; numused &lt;&lt; std::endl;
-            }
-        }
-    }
-}
-
-void connect(Uint16 port)
-{
-  IPaddress ip;
-  
-  if(SDLNet_ResolveHost(&amp;ip,NULL,port)==-1) {
-    printf(&quot;SDLNet_ResolveHost: %s\n&quot;, SDLNet_GetError());
-    exit(1);
-  }
-  serversock = SDLNet_TCP_Open(&amp;ip);
-  if(!serversock) {
-    printf(&quot;SDLNet_TCP_Open: %s\n&quot;, SDLNet_GetError());
-    exit(2);
-  }
-
-  socketset = SDLNet_AllocSocketSet(32);
-  if (!socketset) {
-    printf(&quot;SDLNet_AllocSocketSet: %s\n&quot;, SDLNet_GetError());
-    exit(1); //most of the time this is a major error, but do what you want.
-  }
-
-  SDLNet_TCP_AddSocket(socketset, serversock);
-
-  while(true)
-    {
-      int num = 0;
-      if ((num = SDLNet_CheckSockets(socketset, 10000)) == -1)
-        {
-          printf(&quot;SDLNet_CheckSockets: %s\n&quot;, SDLNet_GetError());
-          //most of the time this is a system error, where perror might help you.
-          perror(&quot;SDLNet_CheckSockets&quot;);
-        }
-      else
-        { 
-          accept_connections();
-       
-          for(int i = 0; i &lt; int(clients.size()); ++i)
-            {
-              if (clients[i])
-                clients[i]-&gt;update();
-            }
-
-          for(int i = 0; i &lt; int(clients.size()); ++i)
-            {
-              if (clients[i] &amp;&amp; clients[i]-&gt;is_invalid())
-                {
-                  std::cout &lt;&lt; &quot;# client &quot; &lt;&lt; clients[i]-&gt;id &lt;&lt; &quot; got disconnected&quot; &lt;&lt; std::endl;
-                  SDLNet_TCP_DelSocket(socketset, clients[i]-&gt;tcpsock); 
-                  SDLNet_TCP_Close(clients[i]-&gt;tcpsock);
-                  delete clients[i];
-                  clients[i] = 0;
-                }
-            }
-        }
-    }
-}
-
-int main(int argc, char** argv)
-{
-  if(SDL_Init(0)==-1) {
-    printf(&quot;SDL_Init: %s\n&quot;, SDL_GetError());
-    exit(1);
-  }
-
-  if(SDLNet_Init()==-1) {
-    printf(&quot;SDLNet_Init: %s\n&quot;, SDLNet_GetError());
-    exit(2);
-  }
-
-  atexit(SDL_Quit);
-  atexit(SDLNet_Quit);
-
-  std::ostringstream filename;
-  filename &lt;&lt; &quot;sessions/session-&quot; &lt;&lt; time(NULL) &lt;&lt; &quot;.nbr&quot;;
-
-  std::cout &lt;&lt; &quot;# writing log to &quot; &lt;&lt; filename.str() &lt;&lt; std::endl;
-  outfile = new std::ofstream(filename.str().c_str());
-
-  if (argc == 2)
-    {
-      std::cout &lt;&lt; &quot;# listening on: &quot; &lt;&lt; argv[1] &lt;&lt; std::endl;
-      connect(atoi(argv[1]));
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; PORT&quot; &lt;&lt; std::endl;
-    }
-
-  outfile-&gt;close();
-  delete outfile;
-
-  return 0;
-}

Deleted: trunk/netbrush/server_connection.cpp
===================================================================
--- trunk/netbrush/server_connection.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/server_connection.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,333 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &lt;sstream&gt;
-#include &quot;globals.hpp&quot;
-#include &quot;client_state.hpp&quot;
-#include &quot;color.hpp&quot;
-#include &quot;drawing_context.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;server_connection.hpp&quot;
-
-static std::vector&lt;std::string&gt;
-tokenize(const std::string&amp; str, char split_char)
-{
-  std::string::size_type start = 0;
-  std::string::size_type end   = 0;
-
-  std::vector&lt;std::string&gt; tokens;
-
-  while (start &lt; str.size())
-    {
-      if ((end = str.find(split_char, start)) == std::string::npos)
-        {
-          tokens.push_back(str.substr(start));
-          break;
-        }
-
-      const std::string&amp; ret = str.substr(start, end - start);
-
-      if (!ret.empty())
-        tokens.push_back(ret);
-
-      start = end + 1;
-    }
-
-  return tokens;
-}
-
-ServerConnection::ServerConnection()
-  : tcpsock(0),
-    socketset(0)
-{
-}
-
-ServerConnection::~ServerConnection()
-{
-}
-
-void
-ServerConnection::send(const std::string&amp; str)
-{
-  if (tcpsock)
-    {
-      int result = SDLNet_TCP_Send(tcpsock, const_cast&lt;char*&gt;(str.c_str()), str.length());
-      if(result &lt; int(str.length()))
-        {
-          printf( &quot;SDLNet_TCP_Send: %s\n&quot;, SDLNet_GetError() );
-          // It may be good to disconnect sock because it is likely invalid now.
-        }     
-    }
-  else
-    { // Not connected, so directly procses the command without a
-      // round trip through the server
-      std::string tmp;
-      for(std::string::size_type i = 0; i &lt; str.length(); ++i)
-        {
-          if (str[i] == '\n')
-            {
-              process_command(&quot;client 0 &quot; + tmp);
-              tmp.clear();
-            }
-          else
-            tmp += str[i];
-        }
-    }  
-}
-
-void
-ServerConnection::connect(const char* hostname, Uint16 port)
-{
-  IPaddress ip;
-
-  if(SDLNet_ResolveHost(&amp;ip, hostname, port) == -1) 
-    {
-      printf(&quot;SDLNet_ResolveHost: %s\n&quot;, SDLNet_GetError());
-      exit(1);
-    }
-
-  tcpsock = SDLNet_TCP_Open(&amp;ip);
-  if(!tcpsock)
-    {
-      printf(&quot;SDLNet_TCP_Open: %s %s:%d\n&quot;, SDLNet_GetError(), hostname, port);
-      exit(2);
-    }
-  else
-    {
-      std::string line = &quot;client_version 1\n&quot;;
-      SDLNet_TCP_Send(tcpsock, const_cast&lt;char*&gt;(line.c_str()), line.length());
-
-      socketset = SDLNet_AllocSocketSet(1);
-      SDLNet_TCP_AddSocket(socketset, tcpsock);
-    }
-}
-
-void
-ServerConnection::update()
-{
-  if (!tcpsock) return;
-
-  int num = 0;
-  if ((num = SDLNet_CheckSockets(socketset, 0)) == -1)
-    {
-      printf(&quot;SDLNet_CheckSockets: %s\n&quot;, SDLNet_GetError());
-      //most of the time this is a system error, where perror might help you.
-      perror(&quot;SDLNet_CheckSockets&quot;);
-    }
-  
-  if (num &gt; 0)
-    {
-      if (SDLNet_SocketReady(tcpsock))
-        {
-          const int MAXLEN = 1024;
-          int result;
-          char msg[MAXLEN];
-
-          result = SDLNet_TCP_Recv(tcpsock, msg, MAXLEN);
-          if(result &lt;= 0) 
-            {
-              // TCP Connection is broken. (because of error or closure)
-              SDLNet_TCP_Close(tcpsock);
-              exit(1);
-            }
-          else 
-            {
-              for(int i = 0; i &lt; result; ++i)
-                {
-                  if (msg[i] == '\n')
-                    {
-                      process_command(buffer);
-                      //std::cout &lt;&lt; server_buffer &lt;&lt; std::endl;
-                      buffer.clear();
-                    }
-                  else
-                    {
-                      buffer += msg[i];
-                    }
-                }
-            }
-        }
-    }
-}
-
-void
-ServerConnection::process_command(const std::string&amp; cmd)
-{
-  if (cmd.empty()) return;
-
-  const std::vector&lt;std::string&gt;&amp; tokens = tokenize(cmd, ' ');
-  if (0)
-    for(int i = 0; i &lt; int(tokens.size()); ++i)
-      std::cout &lt;&lt; &quot;Token: '&quot; &lt;&lt; tokens[i] &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-
-  if (!tokens.empty())
-    {
-      if (tokens[0] == &quot;#&quot;)
-        {
-          // comment, ignore
-        }
-      else if (tokens[0] == &quot;clear&quot;)
-        {
-          draw_ctx-&gt;clear();
-        }
-      else if (tokens[0] == &quot;client&quot;)
-        {
-          if (tokens.size() &gt; 2)
-            {
-              int client_id = atoi(tokens[1].c_str());
-              // convert to stroke
-              std::map&lt;int, ClientState*&gt;::iterator i = client_states.find(client_id);
-              ClientState* client_state = 0;
-              if (i != client_states.end())
-                {
-                  client_state = i-&gt;second;
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;# allocating new ClientState&quot; &lt;&lt; std::endl;
-                  client_state = new ClientState(client_id);
-                  client_states[client_id] = client_state;
-                }
-              
-              if (tokens.size() == 3 &amp;&amp; tokens[2] == &quot;stroke_begin&quot;)
-                {
-                  client_state-&gt;stroke_begin();
-                }
-              else if (tokens.size() == 3 &amp;&amp; tokens[2] == &quot;stroke_end&quot;)
-                {
-                  client_state-&gt;stroke_end();
-                }
-              else if (tokens.size() == 4 &amp;&amp; tokens[2] == &quot;set_brush&quot;)
-                {
-                  client_state-&gt;set_brush(tokens[3]);
-                }
-              else if (tokens.size() == 9 &amp;&amp; tokens[2] == &quot;set_generic_brush&quot;)
-                {
-                  client_state-&gt;set_generic_brush((BrushShape)atoi(tokens[3].c_str()),  // shape FIXME: could use name instead
-                                                  atof(tokens[4].c_str()),  // radius
-                                                  atoi(tokens[5].c_str()),  // spike
-                                                  atof(tokens[6].c_str()),  // hardness
-                                                  atof(tokens[7].c_str()),  // aspectratio
-                                                  atof(tokens[8].c_str())); // angle
-                }
-              else if (tokens.size() == 4 &amp;&amp; tokens[2] == &quot;set_opacity&quot;)
-                {
-                  client_state-&gt;set_opacity(atoi(tokens[3].c_str()));
-                }
-              else if (tokens.size() == 4 &amp;&amp; tokens[2] == &quot;set_tool&quot;)
-                {
-                  client_state-&gt;set_tool(static_cast&lt;DrawingParameter::Tool&gt;(atoi(tokens[3].c_str())));
-                }
-              else if (tokens.size() == 6 &amp;&amp; tokens[2] == &quot;set_color&quot;)
-                {
-                  client_state-&gt;set_color(Color(atoi(tokens[3].c_str()), 
-                                                atoi(tokens[4].c_str()), 
-                                                atoi(tokens[5].c_str())));
-                }
-              else if (tokens.size() == 6 &amp;&amp; tokens[2] == &quot;dab&quot;)
-                {
-                  client_state-&gt;dab(atoi(tokens[3].c_str()), 
-                                    atoi(tokens[4].c_str()),
-                                    atoi(tokens[5].c_str()));
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;# invalid command: &quot; &lt;&lt; cmd &lt;&lt; std::endl;
-                }
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;# invalid command: &quot; &lt;&lt; cmd &lt;&lt; std::endl;
-            }
-        }
-      else if (tokens[0] == &quot;version&quot;)
-        {
-          if (tokens.size() == 2)
-            {
-              if (atoi(tokens[1].c_str()) != 0)
-                {
-                  std::cout &lt;&lt; &quot;# version mismatch: &quot; &lt;&lt; cmd &lt;&lt; std::endl;
-                  std::cout &lt;&lt; &quot;# upgrade your netbrush client&quot; &lt;&lt; std::endl;
-                  exit(1);
-                }
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;# invalid command: &quot; &lt;&lt; cmd &lt;&lt; std::endl;
-            }
-        }
-      else if (tokens[0] == &quot;your_id&quot;)
-        {
-          if (tokens.size() == 2)
-            {
-              std::cout &lt;&lt; &quot;# my Id: &quot; &lt;&lt; atoi(tokens[1].c_str()) &lt;&lt; std::endl;
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;# invalid command: &quot; &lt;&lt; cmd &lt;&lt; std::endl;
-            }
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;# invalid command: &quot; &lt;&lt; cmd &lt;&lt; std::endl;
-        }
-    }
-}
-
-void
-ServerConnection::send_stroke(const Stroke&amp; stroke, DrawingParameter* param)
-{
-  const Stroke::Dabs&amp; dabs = stroke.get_dabs();
-
-  std::stringstream str;
-  if (param-&gt;get_brush().empty())
-    str &lt;&lt; &quot;set_generic_brush &quot; 
-        &lt;&lt; param-&gt;generic_brush.shape &lt;&lt; &quot; &quot;
-        &lt;&lt; param-&gt;generic_brush.radius &lt;&lt; &quot; &quot;
-        &lt;&lt; param-&gt;generic_brush.spikes &lt;&lt; &quot; &quot;
-        &lt;&lt; param-&gt;generic_brush.hardness &lt;&lt; &quot; &quot;
-        &lt;&lt; param-&gt;generic_brush.aspect_ratio &lt;&lt; &quot; &quot;
-        &lt;&lt; param-&gt;generic_brush.angle &lt;&lt; &quot; &quot;
-        &lt;&lt; std::endl;
-  else
-    str &lt;&lt; &quot;set_brush &quot; &lt;&lt; param-&gt;get_brush() &lt;&lt; std::endl;
-  str &lt;&lt; &quot;set_tool &quot; &lt;&lt; param-&gt;tool &lt;&lt; std::endl; 
-  str &lt;&lt; &quot;set_opacity &quot; &lt;&lt; int(param-&gt;opacity) &lt;&lt; std::endl;
-  str &lt;&lt; &quot;set_color &quot;
-      &lt;&lt; int(param-&gt;color.r) &lt;&lt; &quot; &quot; 
-      &lt;&lt; int(param-&gt;color.g) &lt;&lt; &quot; &quot; 
-      &lt;&lt; int(param-&gt;color.b) &lt;&lt; std::endl;
-  str &lt;&lt; &quot;stroke_begin&quot; &lt;&lt; std::endl;
-  for(Stroke::Dabs::const_iterator i = dabs.begin(); i != dabs.end(); ++i)
-    {
-      str &lt;&lt; &quot;dab &quot; &lt;&lt; i-&gt;time &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;pos.x &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;pos.y  &lt;&lt; std::endl;
-    }
-  str &lt;&lt; &quot;stroke_end&quot; &lt;&lt; std::endl;
-      
-  send(str.str());
-}
-
-/* EOF */

Deleted: trunk/netbrush/server_connection.hpp
===================================================================
--- trunk/netbrush/server_connection.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/server_connection.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,62 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_SERVER_CONNECTION_HPP
-#define HEADER_SERVER_CONNECTION_HPP
-
-#include &lt;string&gt;
-#include &quot;SDL_net.h&quot;
-
-class Stroke;
-class DrawingParameter;
-
-/** */
-class ServerConnection
-{
-private:
-  TCPsocket tcpsock;
-  SDLNet_SocketSet socketset;
-  std::string buffer;
-
-public:
-  ServerConnection();
-  ~ServerConnection();
-
-  void connect(const char* hostname, Uint16 port);
-
-  /** Send a string to the server, you must add the trailing newline
-      yourself to \a str */
-  void send(const std::string&amp; str);
-  void send_stroke(const Stroke&amp; stroke, DrawingParameter* param);
-  void update();
-  void process_command(const std::string&amp; cmd);
-private:
-  ServerConnection (const ServerConnection&amp;);
-  ServerConnection&amp; operator= (const ServerConnection&amp;);
-};
-
-#endif
-
-/* EOF */

Copied: trunk/netbrush/src/SConstruct (from rev 662, trunk/netbrush/SConstruct)

Copied: trunk/netbrush/src/alpha_picker.cpp (from rev 647, trunk/netbrush/alpha_picker.cpp)

Copied: trunk/netbrush/src/alpha_picker.hpp (from rev 647, trunk/netbrush/alpha_picker.hpp)

Copied: trunk/netbrush/src/brush_widget.cpp (from rev 656, trunk/netbrush/brush_widget.cpp)

Copied: trunk/netbrush/src/brush_widget.hpp (from rev 647, trunk/netbrush/brush_widget.hpp)

Copied: trunk/netbrush/src/brushmask.cpp (from rev 647, trunk/netbrush/brushmask.cpp)

Copied: trunk/netbrush/src/brushmask.hpp (from rev 647, trunk/netbrush/brushmask.hpp)

Copied: trunk/netbrush/src/client.cpp (from rev 659, trunk/netbrush/client.cpp)

Copied: trunk/netbrush/src/client_state.cpp (from rev 655, trunk/netbrush/client_state.cpp)

Copied: trunk/netbrush/src/client_state.hpp (from rev 655, trunk/netbrush/client_state.hpp)

Copied: trunk/netbrush/src/color.hpp (from rev 647, trunk/netbrush/color.hpp)

Copied: trunk/netbrush/src/debug.cpp (from rev 647, trunk/netbrush/debug.cpp)

Copied: trunk/netbrush/src/debug.hpp (from rev 647, trunk/netbrush/debug.hpp)

Copied: trunk/netbrush/src/drawing_context.cpp (from rev 662, trunk/netbrush/drawing_context.cpp)

Copied: trunk/netbrush/src/drawing_context.hpp (from rev 658, trunk/netbrush/drawing_context.hpp)

Copied: trunk/netbrush/src/drawing_parameter.cpp (from rev 661, trunk/netbrush/drawing_parameter.cpp)

Copied: trunk/netbrush/src/drawing_parameter.hpp (from rev 661, trunk/netbrush/drawing_parameter.hpp)

Copied: trunk/netbrush/src/generic_brush.cpp (from rev 647, trunk/netbrush/generic_brush.cpp)

Copied: trunk/netbrush/src/generic_brush.hpp (from rev 647, trunk/netbrush/generic_brush.hpp)

Copied: trunk/netbrush/src/globals.cpp (from rev 658, trunk/netbrush/globals.cpp)

Copied: trunk/netbrush/src/globals.hpp (from rev 658, trunk/netbrush/globals.hpp)

Copied: trunk/netbrush/src/graphic_context_state.cpp (from rev 662, trunk/netbrush/graphic_context_state.cpp)

Copied: trunk/netbrush/src/graphic_context_state.hpp (from rev 662, trunk/netbrush/graphic_context_state.hpp)

Copied: trunk/netbrush/src/grayscale_buffer.cpp (from rev 661, trunk/netbrush/grayscale_buffer.cpp)

Copied: trunk/netbrush/src/grayscale_buffer.hpp (from rev 647, trunk/netbrush/grayscale_buffer.hpp)

Copied: trunk/netbrush/src/hue_picker.cpp (from rev 647, trunk/netbrush/hue_picker.cpp)

Copied: trunk/netbrush/src/hue_picker.hpp (from rev 647, trunk/netbrush/hue_picker.hpp)

Copied: trunk/netbrush/src/math (from rev 647, trunk/netbrush/math)

Copied: trunk/netbrush/src/navigation.cpp (from rev 660, trunk/netbrush/navigation.cpp)

Copied: trunk/netbrush/src/navigation.hpp (from rev 659, trunk/netbrush/navigation.hpp)

Copied: trunk/netbrush/src/saturation_value_picker.cpp (from rev 647, trunk/netbrush/saturation_value_picker.cpp)

Copied: trunk/netbrush/src/saturation_value_picker.hpp (from rev 647, trunk/netbrush/saturation_value_picker.hpp)

Copied: trunk/netbrush/src/screen_buffer.cpp (from rev 661, trunk/netbrush/screen_buffer.cpp)

Copied: trunk/netbrush/src/screen_buffer.hpp (from rev 660, trunk/netbrush/screen_buffer.hpp)

Copied: trunk/netbrush/src/server.cpp (from rev 655, trunk/netbrush/server.cpp)

Copied: trunk/netbrush/src/server_connection.cpp (from rev 655, trunk/netbrush/server_connection.cpp)

Copied: trunk/netbrush/src/server_connection.hpp (from rev 649, trunk/netbrush/server_connection.hpp)

Copied: trunk/netbrush/src/stroke.cpp (from rev 647, trunk/netbrush/stroke.cpp)

Copied: trunk/netbrush/src/stroke.hpp (from rev 647, trunk/netbrush/stroke.hpp)

Copied: trunk/netbrush/src/stroke_buffer.cpp (from rev 661, trunk/netbrush/stroke_buffer.cpp)

Copied: trunk/netbrush/src/stroke_buffer.hpp (from rev 647, trunk/netbrush/stroke_buffer.hpp)

Copied: trunk/netbrush/src/video.cpp (from rev 653, trunk/netbrush/video.cpp)

Copied: trunk/netbrush/src/video.hpp (from rev 653, trunk/netbrush/video.hpp)

Copied: trunk/netbrush/src/widget (from rev 647, trunk/netbrush/widget)

Deleted: trunk/netbrush/src/widget/button.cpp
===================================================================
--- trunk/netbrush/widget/button.cpp	2006-10-18 21:14:26 UTC (rev 647)
+++ trunk/netbrush/src/widget/button.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,115 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;SDL_image.h&quot;
-#include &quot;widget_manager.hpp&quot;
-#include &quot;../globals.hpp&quot;
-#include &quot;button.hpp&quot;
-
-Button::Button(const Rect&amp; rect_)
-  : Widget(rect_),
-    state(UP),
-    hover(false)
-{
-  up_surface    = IMG_Load(&quot;data/icons/up.png&quot;);
-  down_surface  = IMG_Load(&quot;data/icons/down.png&quot;);
-  hover_surface = IMG_Load(&quot;data/icons/hover.png&quot;);
-}
-
-Button::~Button()
-{
-  
-}
-
-void
-Button::on_enter()
-{
-  hover = true;
-  set_dirty(true);
-}
-
-void
-Button::on_leave()
-{
-  hover = false;
-  set_dirty(true);
-}
-
-void
-Button::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  // std::cout &lt;&lt; &quot;Motion: &quot; &lt;&lt; motion.x &lt;&lt; &quot; &quot; &lt;&lt; motion.y &lt;&lt; std::endl;
-  // FIXME: borked
-}
-
-void
-Button::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (button.button == 1 &amp;&amp; button.state == SDL_PRESSED)
-    {
-      state = DOWN;
-      set_dirty(true);
-      widget_manager-&gt;grab(this);
-    }
-  else if (button.button == 1 &amp;&amp; button.state == SDL_RELEASED)
-    {
-      state = UP;
-      widget_manager-&gt;ungrab(this);
-      set_dirty(true);
-    }
-}
-
-void
-Button::draw(SDL_Surface* target)
-{
-  //Uint32 color = SDL_MapRGB(target-&gt;format, 255, 0, 0);
-
-  SDL_Rect r;
-
-  r.x = get_rect().left;
-  r.y = get_rect().top;
-
-  r.w = get_rect().get_width();
-  r.h = get_rect().get_height();
-
-  switch(state)
-    {
-    case UP:
-      if (hover)
-        SDL_BlitSurface(hover_surface, NULL, target, &amp;r);
-      else
-        SDL_BlitSurface(up_surface, NULL, target, &amp;r);
-      break;
-
-    case DOWN:
-      SDL_BlitSurface(down_surface, NULL, target, &amp;r);
-      break;
-    }
-
-  //SDL_FillRect(target, get_rect(), color);
-}
-
-/* EOF */

Copied: trunk/netbrush/src/widget/button.cpp (from rev 662, trunk/netbrush/widget/button.cpp)

Deleted: trunk/netbrush/src/widget/button.hpp
===================================================================
--- trunk/netbrush/widget/button.hpp	2006-10-18 21:14:26 UTC (rev 647)
+++ trunk/netbrush/src/widget/button.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,62 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_BUTTON_HPP
-#define HEADER_BUTTON_HPP
-
-#include &quot;widget.hpp&quot;
-
-/** */
-class Button : public Widget
-{
-private:
-  enum State { UP, DOWN };
-  State state;
-  bool  hover;
-
-  SDL_Surface* up_surface;
-  SDL_Surface* down_surface;
-  SDL_Surface* hover_surface;
-
-public:
-  Button(const Rect&amp; rect);
-  ~Button();
-
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-
-  void on_enter();
-  void on_leave();
-
-  void draw(SDL_Surface* target);
-  
-private:
-  Button (const Button&amp;);
-  Button&amp; operator= (const Button&amp;);
-};
-
-#endif
-
-/* EOF */

Copied: trunk/netbrush/src/widget/button.hpp (from rev 662, trunk/netbrush/widget/button.hpp)

Deleted: trunk/netbrush/src/widget/callback.hpp
===================================================================
--- trunk/netbrush/widget/callback.hpp	2006-10-18 21:14:26 UTC (rev 647)
+++ trunk/netbrush/src/widget/callback.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,44 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_CALLBACK_HPP
-#define HEADER_CALLBACK_HPP
-
-/** */
-class Callback
-{
-public:
-  Callback() {}
-  virtual ~Callback() {}
-  virtual void operator()(float) =0;
-
-private:
-  Callback (const Callback&amp;);
-  Callback&amp; operator= (const Callback&amp;);
-};
-
-#endif
-
-/* EOF */

Copied: trunk/netbrush/src/widget/scrollbar.cpp (from rev 662, trunk/netbrush/widget/scrollbar.cpp)

Copied: trunk/netbrush/src/widget/scrollbar.hpp (from rev 662, trunk/netbrush/widget/scrollbar.hpp)

Deleted: trunk/netbrush/src/widget/slider_widget.cpp
===================================================================
--- trunk/netbrush/widget/slider_widget.cpp	2006-10-18 21:14:26 UTC (rev 647)
+++ trunk/netbrush/src/widget/slider_widget.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,116 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;algorithm&gt;
-#include &quot;globals.hpp&quot;
-#include &quot;widget_manager.hpp&quot;
-#include &quot;slider_widget.hpp&quot;
-
-SliderWidget::SliderWidget(const Rect&amp; rect_, Callback* callback_)
-  : Widget(rect_), callback(callback_), pos(0.5f), dragging(false)
-{
-}
-
-SliderWidget::~SliderWidget()
-{
-  delete callback;
-}
-
-void
-SliderWidget::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  set_dirty(true);
-  if (dragging)
-    {
-      pos = float(motion.x) / get_rect().get_width();
-      pos = std::max(0.0f, std::min(pos, 1.0f));
-      (*callback)(pos);
-    }
-
-}
-
-void
-SliderWidget::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (button.button == 1)
-    {
-      if (button.state == SDL_RELEASED)
-        {
-          dragging = false;
-          widget_manager-&gt;ungrab(this);
-        }
-      else if (button.state == SDL_PRESSED)
-        {
-          dragging = true;
-
-          pos = float(button.x) / get_rect().get_width();
-          pos = std::max(0.0f, std::min(pos, 1.0f));
-
-          (*callback)(pos);
-
-          set_dirty(true);
-          widget_manager-&gt;grab(this);
-        }
-    }
-}
-
-void
-SliderWidget::on_enter()
-{
-}
-
-void
-SliderWidget::on_leave()
-{
-}
-
-void
-SliderWidget::draw(SDL_Surface* target)
-{
-  SDL_Rect rect;
-  rect.x = get_rect().left;
-  rect.y = get_rect().top;
-  rect.w = get_rect().get_width();
-  rect.h = get_rect().get_height();
-
-  SDL_FillRect(target, &amp;rect, SDL_MapRGB(target-&gt;format, 200, 200, 200));
-
-  rect.x += 2;
-  rect.y += 10;
-  rect.w -= 4;
-  rect.h -= 20;
-
-  SDL_FillRect(target, &amp;rect, SDL_MapRGB(target-&gt;format, 100, 100, 100));
-
-  SDL_Rect slider;
-  slider.x = int(get_rect().get_width() * pos) + get_rect().left - 4;
-  slider.y = 2 + get_rect().top;
-  slider.w = 8;
-  slider.h = get_rect().get_height() - 4;
-
-  SDL_FillRect(target, &amp;slider, SDL_MapRGB(target-&gt;format, 0, 0, 0));
-}
-
-/* EOF */

Copied: trunk/netbrush/src/widget/slider_widget.cpp (from rev 662, trunk/netbrush/widget/slider_widget.cpp)

Deleted: trunk/netbrush/src/widget/slider_widget.hpp
===================================================================
--- trunk/netbrush/widget/slider_widget.hpp	2006-10-18 21:14:26 UTC (rev 647)
+++ trunk/netbrush/src/widget/slider_widget.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,59 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_SLIDER_WIDGET_HPP
-#define HEADER_SLIDER_WIDGET_HPP
-
-#include &quot;callback.hpp&quot;
-#include &quot;widget.hpp&quot;
-
-/** */
-class SliderWidget : public Widget
-{
-private:
-  Callback* callback;
-  float pos;
-  bool  dragging;
-  
-public:
-  SliderWidget(const Rect&amp; rect_, Callback* callback);
-  ~SliderWidget();
-
-  void on_mouse_motion(const MouseMotionEvent&amp; motion);
-  void on_mouse_button(const MouseButtonEvent&amp; button);
-
-  void on_enter();
-  void on_leave();
-
-  void draw(SDL_Surface* target);
-
-private:
-  SliderWidget (const SliderWidget&amp;);
-  SliderWidget&amp; operator= (const SliderWidget&amp;);
-};
-
-#endif
-
-/* EOF */

Copied: trunk/netbrush/src/widget/slider_widget.hpp (from rev 662, trunk/netbrush/widget/slider_widget.hpp)

Deleted: trunk/netbrush/src/widget/widget.cpp
===================================================================
--- trunk/netbrush/widget/widget.cpp	2006-10-18 21:14:26 UTC (rev 647)
+++ trunk/netbrush/src/widget/widget.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,39 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &quot;widget.hpp&quot;
-
-Widget::Widget(const Rect&amp; rect_)
-  : rect(rect_.left+1, rect_.top+1, rect_.right-1, rect_.bottom-1),  // FIXME: Cheap way to add border
-    dirty(false) 
-{
-}
-
-Widget::~Widget()
-{
-}
-
-
-/* EOF */

Copied: trunk/netbrush/src/widget/widget.cpp (from rev 662, trunk/netbrush/widget/widget.cpp)

Deleted: trunk/netbrush/src/widget/widget_manager.cpp
===================================================================
--- trunk/netbrush/widget/widget_manager.cpp	2006-10-18 21:14:26 UTC (rev 647)
+++ trunk/netbrush/src/widget/widget_manager.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,177 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;assert.h&gt;
-#include &lt;iostream&gt;
-#include &quot;../video.hpp&quot;
-#include &quot;widget.hpp&quot;
-#include &quot;events.hpp&quot;
-#include &quot;widget_manager.hpp&quot;
-
-WidgetManager::WidgetManager()
-  : grabbed_widget(0), focused_widget(0)
-{
-  
-}
-
-WidgetManager::~WidgetManager()
-{
-  for(Widgets::iterator i = widgets.begin(); i != widgets.end(); ++i)
-    {
-      delete *i;
-    }
-}
-
-void
-WidgetManager::add(Widget* widget)
-{
-  widget-&gt;set_dirty(true);
-  widgets.push_back(widget);
-}
-
-void
-WidgetManager::on_mouse_motion(const MouseMotionEvent&amp; motion)
-{
-  if (grabbed_widget)
-    {
-      MouseMotionEvent trans_motion(motion);
-
-      trans_motion.x -= grabbed_widget-&gt;get_rect().left;
-      trans_motion.y -= grabbed_widget-&gt;get_rect().top;
-
-      grabbed_widget-&gt;on_mouse_motion(trans_motion);
-    }
-  else
-    {
-      Widget* old_focused_widget = focused_widget;
-      
-      focused_widget = 0;
-
-      for(Widgets::iterator i = widgets.begin(); i != widgets.end(); ++i)
-        {
-          if ((*i)-&gt;get_rect().is_inside(Point(motion.x, motion.y)))
-            {
-              MouseMotionEvent trans_motion(motion);
-
-              trans_motion.x -= (*i)-&gt;get_rect().left;
-              trans_motion.y -= (*i)-&gt;get_rect().top;
-
-              if (!grabbed_widget)
-                focused_widget = (*i);
-              
-              (*i)-&gt;on_mouse_motion(trans_motion);
-              break;
-            }
-        }
-
-      if (!grabbed_widget)
-        {
-          if (old_focused_widget != focused_widget)
-            {
-              if (old_focused_widget)
-                old_focused_widget-&gt;on_leave();
-         
-              if (focused_widget)
-                focused_widget-&gt;on_enter();
-            }
-        }
-      else
-        {
-          focused_widget = grabbed_widget;
-        }
-    }
-}
-
-void
-WidgetManager::on_mouse_button(const MouseButtonEvent&amp; button)
-{
-  if (grabbed_widget)
-    {
-      MouseButtonEvent trans_button(button);
-
-      trans_button.x -= grabbed_widget-&gt;get_rect().left;
-      trans_button.y -= grabbed_widget-&gt;get_rect().top;
-
-      grabbed_widget-&gt;on_mouse_button(trans_button);
-    }
-  else
-    {
-      for(Widgets::iterator i = widgets.begin(); i != widgets.end(); ++i)
-        {
-          if ((*i)-&gt;get_rect().is_inside(Point(button.x, button.y)))
-            {
-              MouseButtonEvent trans_button(button);
-              trans_button.x -= (*i)-&gt;get_rect().left;
-              trans_button.y -= (*i)-&gt;get_rect().top;
-
-              (*i)-&gt;on_mouse_button(trans_button);
-              break;
-            }
-        }  
-    }
-}
-
-void
-WidgetManager::update()
-{
-  for(Widgets::reverse_iterator i = widgets.rbegin(); i != widgets.rend(); ++i)
-    {
-      if ((*i)-&gt;is_dirty())
-        {
-          (*i)-&gt;draw(screen);
-
-          // FIXME: might conflict with Screenbuffers update procedure
-          if ((*i)-&gt;do_update())
-            {
-              if (0)
-                std::cout &lt;&lt; &quot;\nWidgetManager: update: &quot;
-                          &lt;&lt; (*i)-&gt;get_rect().left &lt;&lt; &quot; &quot; &lt;&lt; (*i)-&gt;get_rect().top &lt;&lt; &quot; &quot;
-                          &lt;&lt; (*i)-&gt;get_rect().get_width() &lt;&lt; &quot; &quot; &lt;&lt; (*i)-&gt;get_rect().get_height() &lt;&lt; std::endl;
-
-              SDL_UpdateRect(screen, 
-                             (*i)-&gt;get_rect().left,        (*i)-&gt;get_rect().top,
-                             (*i)-&gt;get_rect().get_width(), (*i)-&gt;get_rect().get_height());
-            }
-
-          (*i)-&gt;set_dirty(false);
-        }
-    }  
-}
-
-void
-WidgetManager::grab(Widget* widget)
-{
-  assert(grabbed_widget == 0);
-  grabbed_widget = widget;
-}
-
-void
-WidgetManager::ungrab(Widget* widget)
-{
-  //assert(grabbed_widget == widget);
-  grabbed_widget = 0;
-}
-
-/* EOF */

Copied: trunk/netbrush/src/widget/widget_manager.cpp (from rev 662, trunk/netbrush/widget/widget_manager.cpp)

Deleted: trunk/netbrush/stroke.cpp
===================================================================
--- trunk/netbrush/stroke.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/stroke.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,126 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;math.h&gt;
-#include &quot;stroke.hpp&quot;
-
-Stroke::Stroke()
-{
-  
-}
-
-Stroke::~Stroke()
-{
-  
-}
-
-Stroke::Dabs
-Stroke::get_interpolated_dabs(float x_spacing, float y_spacing) const
-{
-  if (dabs.size() &gt; 0)
-    {
-      Dabs interpolated_dabs;
-
-      interpolated_dabs.push_back(dabs.front());
-
-      // The following code basically takes all the event dabs as recieved
-      // by from the InputDevice and interpolates new dabs inbetween to
-      // give them an equal spacing (ie. every dab is only 'spacing' away
-      // from the next)
-      float overspace = 0.0f;
-      for(unsigned int j = 0; j &lt; dabs.size()-1; ++j)
-        {
-          Vector dist = dabs[j+1].pos - dabs[j].pos;
-          float length = sqrt(dist.x * dist.x + dist.y * dist.y);
-          int n = 1;
-    
-          // Spacing is keep relative to the brush size
-          // FIXME: This is specific to a Sprite based drawer, might not work for others
-          // FIXME: y_spacing isn't taken into account either
-          float local_spacing = x_spacing * dabs[j].pressure;
-
-          while (length + overspace &gt; (local_spacing * n))
-            {
-              float factor = (local_spacing/length) * n - (overspace/length);
-          
-              // FIXME: Interpolate tilting, pressure, etc. along the line
-              interpolated_dabs.push_back(Dab(dabs[j].pos.x + dist.x * factor,
-                                              dabs[j].pos.y + dist.y * factor,
-                                              dabs[j].pressure));
-              n += 1;
-            }
-
-          // calculate the space that wasn't used in the last iteration
-          overspace = (length + overspace) - (local_spacing * (n-1));
-        }
-      return interpolated_dabs;
-    }
-  else
-    {
-      // No dabs available, so nothing to interpolate
-      return dabs;
-    }
-}
-
-const Stroke::Dabs&amp;
-Stroke::get_dabs() const
-{
-  return dabs; 
-}
-
-int
-Stroke::get_dab_count() const
-{
-  return dabs.size();
-}
-
-void
-Stroke::add_dab(const Dab&amp; dab)
-{
-  if(dabs.empty())
-    {
-      bounding_rect = Rect(Point(static_cast&lt;int&gt;(dab.pos.x),
-                                 static_cast&lt;int&gt;(dab.pos.y)),
-                           Size(1, 1));
-    }
-  else
-    {
-      bounding_rect.left    = std::min(bounding_rect.left,   static_cast&lt;int&gt;(dab.pos.x));
-      bounding_rect.top     = std::min(bounding_rect.top,    static_cast&lt;int&gt;(dab.pos.y));
-
-      bounding_rect.right   = std::max(bounding_rect.right,  static_cast&lt;int&gt;(dab.pos.x));
-      bounding_rect.bottom  = std::max(bounding_rect.bottom, static_cast&lt;int&gt;(dab.pos.y));
-    }
-
-  dabs.push_back(dab);
-}
-
-const Rect&amp;
-Stroke::get_bounding_rect() const
-{
-  return bounding_rect; 
-}
-
-/* EOF */

Deleted: trunk/netbrush/stroke.hpp
===================================================================
--- trunk/netbrush/stroke.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/stroke.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,104 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_STROKE_HPP
-#define HEADER_STROKE_HPP
-
-#include &quot;SDL.h&quot;
-#include &lt;vector&gt;
-#include &quot;math/vector.hpp&quot;
-#include &quot;math/rect.hpp&quot;
-
-/** A dab is basically an event send from the mouse to the drawing
-    canvas, it consists of time, position, tilt, pressure and possible
-    additional information that is needed */
-class Dab
-{
-public:
-  /** Time at which the dot was placed */
-  unsigned int time;
-
-  /** Position at which the dot is placed */
-  Vector pos;
-
-  /** The pressure with which the dot was drawn (can be interpreted as
-      size, opacity or similar things by the StrokeDrawer */
-  float pressure;
-
-  /** Tilting of the pen while painting the dot */
-  Vector tilt;
-
-  Dab()
-    : time(SDL_GetTicks()), pos(0, 0), pressure(1.0f), tilt(0, 0)
-  {}
-
-  Dab(float x, float y) 
-    : time(SDL_GetTicks()), pos(x, y), pressure(1.0f), tilt(0.0f, 0.0f)
-  {}
-
-  Dab(float x_, float y_, float pressure_)
-    : time(SDL_GetTicks()), pos(x_, y_), pressure(pressure_), tilt(0.0f, 0.0f)
-  {}
-};
-
-/** */
-class Stroke
-{
-public:
-  typedef std::vector&lt;Dab&gt; Dabs;
-
-private:
-  Stroke::Dabs dabs;
-  Rect bounding_rect;
-
-public:
-  Stroke();
-  ~Stroke();
-
-  /** Return true if the Stroke doesn't contain any dabs */
-  bool empty() const { return dabs.empty(); }
-
-  void  add_dab(const Dab&amp; dab);
-  
-  /** Returns the real dabs as recieved by the InputDevice */
-  const Dabs&amp;  get_dabs()  const;
-
-  /** Returns interpolated dabs, meaning the holes in get_dabs() are
-      closed with interpolated dabs so that all dabs are equally
-      spread (ie. every dab is 'spacing' away from the next) */
-  Dabs  get_interpolated_dabs(float x_spacing, float y_spacing) const;
-
-  int get_dab_count() const;
-
-  const Rect&amp; get_bounding_rect() const;
-
-private:
-  Stroke (const Stroke&amp;);
-  Stroke&amp; operator= (const Stroke&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/stroke_buffer.cpp
===================================================================
--- trunk/netbrush/stroke_buffer.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/stroke_buffer.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,170 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;math/rect.hpp&quot;
-#include &quot;grayscale_buffer.hpp&quot;
-#include &quot;stroke.hpp&quot;
-#include &quot;video.hpp&quot;
-#include &quot;drawing_parameter.hpp&quot;
-#include &quot;stroke_buffer.hpp&quot;
-
-StrokeBuffer::StrokeBuffer(int w, int h)
-  : param(0)
-{
-  buffer = new GrayscaleBuffer(w, h, 0);
-  stroke = new Stroke();
-}
-
-StrokeBuffer::~StrokeBuffer()
-{
-  delete stroke;
-  delete buffer;
-}
-
-void
-StrokeBuffer::clear(const Rect&amp; rect)
-{
-  buffer-&gt;fill_rect(rect, 0);  
-}
-
-void
-StrokeBuffer::clear()
-{
-  buffer-&gt;clear(0);
-
-  // FIXME: This doesn't belong here
-  delete this-&gt;stroke;
-  this-&gt;stroke = new Stroke();
-}
-
-void
-StrokeBuffer::add_dab(const Dab&amp; dab)
-{
-  //  for(int y = - 5; y &lt; 10; ++y)
-  //for(int x = - 5; x &lt; 10; ++x)
-  //buffer-&gt;at(int(dab.pos.x)+x, int(dab.pos.y)+y) = 128;
-
-  GrayscaleBuffer* brush = param-&gt;get_brush_buffer();
-
-  stroke-&gt;add_dab(dab);
-  if (1)
-    {
-      buffer-&gt;blit(brush,
-                   static_cast&lt;int&gt;(dab.pos.x - brush-&gt;get_width()/2), 
-                   static_cast&lt;int&gt;(dab.pos.y - brush-&gt;get_height()/2), 
-                   GrayscaleBuffer::ALPHA);
-    }
-  else
-    { // FIXME: SLOW!
-      buffer-&gt;clear(0);
-      draw_stroke(*stroke, param);
-    }
-}
-
-void
-StrokeBuffer::draw_stroke(const Stroke&amp; stroke, DrawingParameter* param)
-{
-  GrayscaleBuffer* brush = param-&gt;get_brush_buffer();
-
-  if (param-&gt;tool == DrawingParameter::TOOL_AIRBRUSH)
-    {
-      Stroke::Dabs dabs = stroke.get_dabs();
-      for(Stroke::Dabs::iterator i = dabs.begin(); i != dabs.end(); ++i)
-        {
-          buffer-&gt;blit(brush,
-                       static_cast&lt;int&gt;(i-&gt;pos.x - brush-&gt;get_width()/2), 
-                       static_cast&lt;int&gt;(i-&gt;pos.y - brush-&gt;get_height()/2), 
-                       GrayscaleBuffer::ALPHA);
-        }
-    }
-  else if (param-&gt;tool == DrawingParameter::TOOL_PAINTBRUSH)
-    {
-      Stroke::Dabs dabs = stroke.get_interpolated_dabs(param-&gt;get_spacing(), param-&gt;get_spacing());
-      for(Stroke::Dabs::iterator i = dabs.begin(); i != dabs.end(); ++i)
-        {
-          buffer-&gt;blit(brush,
-                       static_cast&lt;int&gt;(i-&gt;pos.x - brush-&gt;get_width()/2), 
-                       static_cast&lt;int&gt;(i-&gt;pos.y - brush-&gt;get_height()/2), 
-                       GrayscaleBuffer::ALPHA);
-        }      
-    }
-}
-
-  void
-    StrokeBuffer::draw(SDL_Surface* target, const Rect&amp; rect, int x_of, int y_of)
-  { 
-    // rect is in screenspace, x_of, y_of tell how to go from canvas to screenspace
-    SDL_LockSurface(target);
-
-    Uint8* dst = static_cast&lt;Uint8*&gt;(target-&gt;pixels);
-    Uint8* src = buffer-&gt;get_data();
-  
-    assert(rect.left &gt;= 0);
-    if (0)
-      std::cout &lt;&lt; &quot;StrokeBuffer::draw: &quot; &lt;&lt; target &lt;&lt; &quot; &quot; &lt;&lt; rect.left &lt;&lt; &quot; &quot; &lt;&lt; rect.top &lt;&lt; &quot; &quot;
-                &lt;&lt; rect.right &lt;&lt; &quot; &quot; &lt;&lt; rect.bottom &lt;&lt; &quot; - &quot; &lt;&lt; x_of &lt;&lt; &quot; &quot; &lt;&lt; y_of &lt;&lt; std::endl;
-
-    if (target == screen) // FIXME: Ugly workaround
-      {
-        for(int y = rect.top; y &lt; rect.bottom; ++y)
-          for(int x = rect.left; x &lt; rect.right; ++x)
-            {
-              Uint8* d = dst + (y * target-&gt;pitch + target-&gt;format-&gt;BytesPerPixel * x);
-              Uint8  s = src[(y - y_of) * buffer-&gt;get_width() + (x - x_of)];
-
-              s = (s * param-&gt;opacity)/255;
-
-              d[0] = ((255 - s) * d[0] + (s * param-&gt;color.b))/255;
-              d[1] = ((255 - s) * d[1] + (s * param-&gt;color.g))/255;
-              d[2] = ((255 - s) * d[2] + (s * param-&gt;color.r))/255;
-            }
-      }
-    else
-      {
-        for(int y = rect.top; y &lt; rect.bottom; ++y)
-          for(int x = rect.left; x &lt; rect.right; ++x)
-            {
-              Uint8* d = dst + (y * target-&gt;pitch + target-&gt;format-&gt;BytesPerPixel * x);
-              Uint8  s = src[(y - y_of) * buffer-&gt;get_width() + (x - x_of)];
-
-              s = (s * param-&gt;opacity)/255;
-
-              d[0] = ((255 - s) * d[0] + (s * param-&gt;color.r))/255;
-              d[1] = ((255 - s) * d[1] + (s * param-&gt;color.g))/255;
-              d[2] = ((255 - s) * d[2] + (s * param-&gt;color.b))/255;
-            }
-      }
-
-    SDL_UnlockSurface(target);
-  }
-
-  void
-    StrokeBuffer::set_param(DrawingParameter* param_)
-  {
-    param = param_;
-  }
-
-  /* EOF */

Deleted: trunk/netbrush/stroke_buffer.hpp
===================================================================
--- trunk/netbrush/stroke_buffer.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/stroke_buffer.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,62 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_STROKE_BUFFER_HPP
-#define HEADER_STROKE_BUFFER_HPP
-
-class Rect;
-class DrawingParameter;
-class Dab;
-
-/** */
-class StrokeBuffer
-{
-private:
-  GrayscaleBuffer*  buffer;
-  Stroke*           stroke;
-  DrawingParameter* param;
-
-public:
-  StrokeBuffer(int w, int h);
-  ~StrokeBuffer();
-
-  void set_param(DrawingParameter* param);
-
-  void add_dab(const Dab&amp; dab);
-  void clear();
-  void clear(const Rect&amp; rect);
-
-  void draw(SDL_Surface* target, const Rect&amp; rect, int x_of, int y_of);
-
-  void draw_stroke(const Stroke&amp; stroke, DrawingParameter* param);
-
-private:
-  StrokeBuffer (const StrokeBuffer&amp;);
-  StrokeBuffer&amp; operator= (const StrokeBuffer&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/netbrush/video.cpp
===================================================================
--- trunk/netbrush/video.cpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/video.cpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,83 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include &lt;algorithm&gt;
-#include &quot;math/rect.hpp&quot;
-#include &quot;video.hpp&quot;
-
-SDL_Surface* screen = 0;
-
-void clip_to(SDL_Rect* rect, SDL_Rect* clip_rect)
-{
-  int x1 = std::max(clip_rect-&gt;x, rect-&gt;x);
-  int y1 = std::max(clip_rect-&gt;y, rect-&gt;y);
-
-  int x2 = std::min(clip_rect-&gt;x + clip_rect-&gt;w, rect-&gt;x + rect-&gt;w);
-  int y2 = std::min(clip_rect-&gt;y + clip_rect-&gt;h, rect-&gt;y + rect-&gt;h);  
-
-  rect-&gt;x = x1;
-  rect-&gt;y = y1;
-
-  rect-&gt;w = x2 - x1;
-  rect-&gt;h = y2 - y1;
-}
-
-void clip_to(Rect&amp; rect, const Rect&amp; clip_rect)
-{
-  rect.left   = std::max(rect.left,   clip_rect.left);
-  rect.right  = std::min(rect.right,  clip_rect.right);
-  rect.top    = std::max(rect.top,    clip_rect.top);
-  rect.bottom = std::min(rect.bottom, clip_rect.bottom);
-}
-
-SDL_Surface* create_surface(int w, int h)
-{
-  Uint32 rmask, gmask, bmask, amask;
-
-  /* SDL interprets each pixel as a 32-bit number, so our masks must depend
-     on the endianness (byte order) of the machine */
-#if SDL_BYTEORDER == SDL_BIG_ENDIAN
-  rmask = 0xff000000;
-  gmask = 0x00ff0000;
-  bmask = 0x0000ff00;
-  amask = 0; //0x000000ff;
-#else
-  rmask = 0x000000ff;
-  gmask = 0x0000ff00;
-  bmask = 0x00ff0000;
-  amask = 0; //0xff000000;
-#endif
-
-  SDL_Surface* drawable = SDL_CreateRGBSurface(SDL_SWSURFACE, w, h, 24,
-                                  rmask, gmask, bmask, amask);
-  if(drawable == NULL) {
-    fprintf(stderr, &quot;CreateRGBSurface failed: %s\n&quot;, SDL_GetError());
-    exit(1);
-  }
-
-  return drawable;
-}
-
-/* EOF */

Deleted: trunk/netbrush/video.hpp
===================================================================
--- trunk/netbrush/video.hpp	2006-10-20 08:29:30 UTC (rev 662)
+++ trunk/netbrush/video.hpp	2006-10-20 08:32:24 UTC (rev 663)
@@ -1,41 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/flexlay-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef HEADER_VIDEO_HPP
-#define HEADER_VIDEO_HPP
-
-#include &quot;SDL.h&quot;
-
-extern SDL_Surface* screen;
-
-class Rect;
-
-void clip_to(SDL_Rect* rect, SDL_Rect* clip_rect);
-void clip_to(Rect&amp; rect, const Rect&amp; clip_rect);
-SDL_Surface* create_surface(int w, int h);
-
-#endif
-
-/* EOF */


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000157.html">[Flexlay-commit] r662 - trunk/netbrush
</A></li>
	<LI>Next message: <A HREF="000159.html">[Flexlay-commit] r664 - in trunk/netbrush: . src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#158">[ date ]</a>
              <a href="thread.html#158">[ thread ]</a>
              <a href="subject.html#158">[ subject ]</a>
              <a href="author.html#158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/flexlay-commit">More information about the Flexlay-commit
mailing list</a><br>
</body></html>
